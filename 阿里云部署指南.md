# ğŸŒ å°å­¦AIå®¶æ•™ç³»ç»Ÿ - é˜¿é‡Œäº‘éƒ¨ç½²æŒ‡å—

## ğŸ¯ éƒ¨ç½²ä¼˜åŠ¿

âœ… **è§£å†³æœ¬åœ°é—®é¢˜**
- ç¨³å®šçš„å…¬ç½‘IPï¼Œæ— éœ€æœ¬åœ°IPé…ç½®
- è§£å†³MongoDBè¿æ¥è¶…æ—¶é—®é¢˜  
- å°ç¨‹åºç›´æ¥è¿æ¥äº‘ç«¯æœåŠ¡
- 24/7ç¨³å®šè¿è¡Œ

âœ… **å¼€å‘æ•ˆç‡æå‡**
- ä»£ç ä¿®æ”¹ç«‹å³ç”Ÿæ•ˆ
- å¤šè®¾å¤‡è®¿é—®åŒä¸€ç¯å¢ƒ
- æ›´æ¥è¿‘ç”Ÿäº§ç¯å¢ƒçš„æµ‹è¯•

## ğŸ“‹ ç¬¬ä¸€æ­¥ï¼šè´­ä¹°é˜¿é‡Œäº‘æœåŠ¡

### ğŸ–¥ï¸ ECSäº‘æœåŠ¡å™¨é…ç½®
```bash
# æ¨èé…ç½®
å®ä¾‹è§„æ ¼: ecs.t5-c1m2.large (2æ ¸4GB)
æ“ä½œç³»ç»Ÿ: Ubuntu 20.04 LTS 64ä½
ç³»ç»Ÿç›˜: 40GB SSDäº‘ç›˜
å…¬ç½‘å¸¦å®½: æŒ‰é‡ä»˜è´¹ï¼Œå³°å€¼3Mbps
å®‰å…¨ç»„: å¼€æ”¾22(SSH), 80(HTTP), 443(HTTPS), 3000(åç«¯), 27017(MongoDB)
```

### ğŸ’¾ æ•°æ®åº“é€‰æ‹© (æ¨èæ–¹æ¡ˆBçœé’±)
```bash
# æ–¹æ¡ˆA: äº‘æ•°æ®åº“MongoDBç‰ˆ (Â¥150/æœˆ)
- è‡ªåŠ¨å¤‡ä»½ã€ç›‘æ§ã€è¿ç»´
- é«˜å¯ç”¨æ¶æ„

# æ–¹æ¡ˆB: è‡ªå»ºMongoDB (æ¨è)
- æˆæœ¬ä½ï¼ŒåŒ…å«åœ¨ECSè´¹ç”¨ä¸­
- é€‚åˆå¼€å‘å’Œå°è§„æ¨¡éƒ¨ç½²
```

## ğŸš€ ç¬¬äºŒæ­¥ï¼šä¸€é”®éƒ¨ç½²è„šæœ¬

### ğŸ“ æœåŠ¡å™¨åˆå§‹åŒ–è„šæœ¬

```bash
#!/bin/bash
# ä¿å­˜ä¸º: server_init.sh

echo "ğŸš€ å¼€å§‹åˆå§‹åŒ–é˜¿é‡Œäº‘æœåŠ¡å™¨..."

# 1. æ›´æ–°ç³»ç»Ÿ
sudo apt update && sudo apt upgrade -y

# 2. å®‰è£…Node.js 18.x
curl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash -
sudo apt-get install -y nodejs

# 3. å®‰è£…MongoDB
sudo apt-get install gnupg
wget -qO - https://www.mongodb.org/static/pgp/server-6.0.asc | sudo apt-key add -
echo "deb [ arch=amd64,arm64 ] https://repo.mongodb.org/apt/ubuntu focal/mongodb-org/6.0 multiverse" | sudo tee /etc/apt/sources.list.d/mongodb-org-6.0.list
sudo apt-get update
sudo apt-get install -y mongodb-org

# 4. å®‰è£…PM2 (è¿›ç¨‹ç®¡ç†)
sudo npm install -g pm2

# 5. å®‰è£…Git
sudo apt-get install -y git

# 6. åˆ›å»ºé¡¹ç›®ç›®å½•
sudo mkdir -p /var/www/smart-tutor
sudo chown -R $USER:$USER /var/www/smart-tutor

# 7. å¯åŠ¨MongoDB
sudo systemctl start mongod
sudo systemctl enable mongod

echo "âœ… æœåŠ¡å™¨åˆå§‹åŒ–å®Œæˆï¼"
```

### ğŸ“¦ é¡¹ç›®éƒ¨ç½²è„šæœ¬

```bash
#!/bin/bash
# ä¿å­˜ä¸º: deploy.sh

echo "ğŸ“¦ å¼€å§‹éƒ¨ç½²å°å­¦AIå®¶æ•™ç³»ç»Ÿ..."

# 1. è¿›å…¥é¡¹ç›®ç›®å½•
cd /var/www/smart-tutor

# 2. å…‹éš†æˆ–æ›´æ–°ä»£ç 
if [ -d ".git" ]; then
    echo "ğŸ”„ æ›´æ–°ç°æœ‰ä»£ç ..."
    git pull origin main
else
    echo "ğŸ“¥ é¦–æ¬¡éƒ¨ç½²ï¼Œå…‹éš†ä»£ç ..."
    git clone https://github.com/ä½ çš„ç”¨æˆ·å/smart_tutor.git .
fi

# 3. åç«¯éƒ¨ç½²
cd server
echo "ğŸ“š å®‰è£…åç«¯ä¾èµ–..."
npm install

# 4. åˆ›å»ºç¯å¢ƒå˜é‡æ–‡ä»¶
cat > .env << EOF
# æ•°æ®åº“é…ç½®
MONGODB_URI=mongodb://localhost:27017/smart_tutor

# AIæœåŠ¡é…ç½®  
DASHSCOPE_API_KEY=ä½ çš„APIå¯†é’¥

# æœåŠ¡å™¨é…ç½®
PORT=3000
NODE_ENV=production

# JWTé…ç½®
JWT_SECRET=ä½ çš„JWTå¯†é’¥
EOF

# 5. å¯åŠ¨åç«¯æœåŠ¡
echo "ğŸš€ å¯åŠ¨åç«¯æœåŠ¡..."
pm2 delete smart-tutor-backend 2>/dev/null || true
pm2 start app.js --name "smart-tutor-backend"

# 6. é…ç½®PM2å¼€æœºå¯åŠ¨
pm2 startup
pm2 save

echo "ğŸ‰ éƒ¨ç½²å®Œæˆï¼"
echo "ğŸŒ åç«¯æœåŠ¡: http://ä½ çš„æœåŠ¡å™¨IP:3000"
echo "ğŸ“š å¥åº·æ£€æŸ¥: http://ä½ çš„æœåŠ¡å™¨IP:3000/health"
```

## ğŸ”§ ç¬¬ä¸‰æ­¥ï¼šé…ç½®åŸŸåå’ŒSSL

### ğŸŒ åŸŸåé…ç½®
```bash
# 1. è´­ä¹°åŸŸå (ä¾‹å¦‚: smarttutor.example.com)
# 2. åœ¨åŸŸåæ§åˆ¶å°æ·»åŠ Aè®°å½•
# è®°å½•ç±»å‹: A
# ä¸»æœºè®°å½•: api
# è®°å½•å€¼: ä½ çš„ECSå…¬ç½‘IP
```

### ğŸ”’ SSLè¯ä¹¦é…ç½® (Nginx + Let's Encrypt)
```bash
#!/bin/bash
# ä¿å­˜ä¸º: ssl_setup.sh

# 1. å®‰è£…Nginx
sudo apt-get install -y nginx

# 2. å®‰è£…Certbot
sudo apt-get install -y certbot python3-certbot-nginx

# 3. é…ç½®Nginx
sudo tee /etc/nginx/sites-available/smart-tutor << EOF
server {
    listen 80;
    server_name api.smarttutor.example.com;
    
    location / {
        proxy_pass http://localhost:3000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade \$http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host \$host;
        proxy_set_header X-Real-IP \$remote_addr;
        proxy_set_header X-Forwarded-For \$proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto \$scheme;
        proxy_cache_bypass \$http_upgrade;
    }
}
EOF

# 4. å¯ç”¨ç«™ç‚¹
sudo ln -s /etc/nginx/sites-available/smart-tutor /etc/nginx/sites-enabled/
sudo nginx -t
sudo systemctl restart nginx

# 5. ç”³è¯·SSLè¯ä¹¦
sudo certbot --nginx -d api.smarttutor.example.com

echo "ğŸ”’ SSLè¯ä¹¦é…ç½®å®Œæˆï¼"
```

## ğŸ“± ç¬¬å››æ­¥ï¼šå°ç¨‹åºé…ç½®æ›´æ–°

### ğŸ”§ æ›´æ–°å°ç¨‹åºç½‘ç»œé…ç½®
```javascript
// miniprogram/utils/config.js
const config = {
  // äº‘ç«¯APIåœ°å€
  apiBaseUrl: 'https://api.smarttutor.example.com',
  
  // å¼€å‘ç¯å¢ƒæ£€æµ‹
  isDev: false, // äº‘ç«¯éƒ¨ç½²è®¾ä¸ºfalse
  
  // è¯·æ±‚è¶…æ—¶
  timeout: 30000
}

export default config
```

### ğŸ“‹ å¾®ä¿¡å°ç¨‹åºåå°é…ç½®
```bash
# åœ¨å¾®ä¿¡å°ç¨‹åºåå° (mp.weixin.qq.com) é…ç½®ï¼š

1. å¼€å‘ -> å¼€å‘ç®¡ç† -> å¼€å‘è®¾ç½®
2. æœåŠ¡å™¨åŸŸå -> requeståˆæ³•åŸŸå
   æ·»åŠ : https://api.smarttutor.example.com

3. ä¸å†éœ€è¦"ä¸æ ¡éªŒåˆæ³•åŸŸå"é€‰é¡¹
```

## ğŸ”„ ç¬¬äº”æ­¥ï¼šè‡ªåŠ¨åŒ–éƒ¨ç½²æµç¨‹

### ğŸ“ GitHub Actionsè‡ªåŠ¨éƒ¨ç½²
```yaml
# .github/workflows/deploy.yml
name: Deploy to Aliyun ECS

on:
  push:
    branches: [ main ]

jobs:
  deploy:
    runs-on: ubuntu-latest
    
    steps:
    - name: Deploy to server
      uses: appleboy/ssh-action@v0.1.8
      with:
        host: ${{ secrets.HOST }}
        username: ${{ secrets.USERNAME }}
        key: ${{ secrets.SSH_KEY }}
        script: |
          cd /var/www/smart-tutor
          git pull origin main
          cd server
          npm install
          pm2 reload smart-tutor-backend
```

## ğŸ’° æˆæœ¬é¢„ä¼°

```bash
ğŸ“Š æœˆåº¦è´¹ç”¨é¢„ä¼°:
- ECSæœåŠ¡å™¨(2æ ¸4GB): Â¥180-250
- å¸¦å®½è´¹ç”¨(3Mbps): Â¥40-60  
- åŸŸåè´¹ç”¨: Â¥5/æœˆ
- SSLè¯ä¹¦: å…è´¹

ğŸ’¡ æ€»è®¡: Â¥225-315/æœˆ

ğŸ¯ å¹´åº¦è´¹ç”¨: Â¥2700-3780
   (ç›¸æ¯”æœ¬åœ°å¼€å‘ç¯å¢ƒæ›´ç¨³å®šå¯é )
```

## ğŸ› ï¸ ç»´æŠ¤å’Œç›‘æ§

### ğŸ“Š ç³»ç»Ÿç›‘æ§è„šæœ¬
```bash
#!/bin/bash
# ä¿å­˜ä¸º: monitor.sh

# 1. æ£€æŸ¥æœåŠ¡çŠ¶æ€
pm2 status

# 2. æ£€æŸ¥MongoDBçŠ¶æ€  
sudo systemctl status mongod

# 3. æ£€æŸ¥ç£ç›˜ä½¿ç”¨
df -h

# 4. æ£€æŸ¥å†…å­˜ä½¿ç”¨
free -h

# 5. æŸ¥çœ‹åº”ç”¨æ—¥å¿—
pm2 logs smart-tutor-backend --lines 50
```

### ğŸ”„ å®šæœŸå¤‡ä»½è„šæœ¬
```bash
#!/bin/bash
# ä¿å­˜ä¸º: backup.sh

DATE=$(date +%Y%m%d_%H%M%S)
BACKUP_DIR="/var/backups/smart-tutor"

# 1. åˆ›å»ºå¤‡ä»½ç›®å½•
sudo mkdir -p $BACKUP_DIR

# 2. å¤‡ä»½MongoDB
mongodump --db smart_tutor --out $BACKUP_DIR/mongodb_$DATE

# 3. å¤‡ä»½ä»£ç 
tar -czf $BACKUP_DIR/code_$DATE.tar.gz /var/www/smart-tutor

# 4. æ¸…ç†7å¤©å‰çš„å¤‡ä»½
find $BACKUP_DIR -name "*.tar.gz" -mtime +7 -delete

echo "âœ… å¤‡ä»½å®Œæˆ: $DATE"
```

## ğŸš€ å¼€å§‹éƒ¨ç½²

### ğŸ“‹ æ“ä½œæ¸…å•
- [ ] è´­ä¹°é˜¿é‡Œäº‘ECSæœåŠ¡å™¨
- [ ] è´­ä¹°åŸŸå
- [ ] è¿è¡ŒæœåŠ¡å™¨åˆå§‹åŒ–è„šæœ¬
- [ ] ä¸Šä¼ ä»£ç å¹¶è¿è¡Œéƒ¨ç½²è„šæœ¬  
- [ ] é…ç½®åŸŸåè§£æ
- [ ] ç”³è¯·SSLè¯ä¹¦
- [ ] æ›´æ–°å°ç¨‹åºé…ç½®
- [ ] æµ‹è¯•æ‰€æœ‰åŠŸèƒ½

éƒ¨ç½²å®Œæˆåï¼Œæ‚¨å°†æ‹¥æœ‰ï¼š
- ğŸŒ ç¨³å®šçš„äº‘ç«¯APIæœåŠ¡
- ğŸ”’ HTTPSå®‰å…¨è¿æ¥
- ğŸ“± å°ç¨‹åºå¯ç›´æ¥è¿æ¥äº‘ç«¯
- ğŸš€ æ— æœ¬åœ°ä¾èµ–çš„å¼€å‘ç¯å¢ƒ

éœ€è¦æˆ‘å¸®æ‚¨å¼€å§‹å®æ–½è¿™ä¸ªéƒ¨ç½²æ–¹æ¡ˆå—ï¼Ÿ 