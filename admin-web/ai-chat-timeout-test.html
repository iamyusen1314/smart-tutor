<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ• AIèŠå¤©è¶…æ—¶å¤„ç†æµ‹è¯•</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            min-height: 100vh;
            color: #333;
        }
        
        .container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.15);
        }
        
        h1 {
            text-align: center;
            color: #E91E63;
            margin-bottom: 30px;
            font-size: 2.5em;
            text-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .test-section {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            margin: 20px 0;
            border-left: 5px solid #E91E63;
        }
        
        .test-section h3 {
            color: #E91E63;
            margin-top: 0;
            font-size: 1.4em;
        }
        
        .test-button {
            background: linear-gradient(45deg, #FF6B9D, #E91E63);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            margin: 8px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(233, 30, 99, 0.3);
        }
        
        .test-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(233, 30, 99, 0.4);
        }
        
        .test-button:disabled {
            background: #cccccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .result-area {
            background: #ffffff;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            padding: 20px;
            margin: 15px 0;
            min-height: 120px;
            font-family: 'Courier New', monospace;
            white-space: pre-wrap;
            font-size: 14px;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .success {
            color: #28a745;
            background-color: #d4edda;
            border-color: #c3e6cb;
        }
        
        .error {
            color: #dc3545;
            background-color: #f8d7da;
            border-color: #f5c6cb;
        }
        
        .warning {
            color: #ffc107;
            background-color: #fff3cd;
            border-color: #ffeaa7;
        }
        
        .info {
            color: #17a2b8;
            background-color: #d1ecf1;
            border-color: #bee5eb;
        }
        
        .stats-panel {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .stats-item {
            display: inline-block;
            margin: 10px 15px;
            text-align: center;
        }
        
        .stats-value {
            font-size: 2em;
            font-weight: bold;
            display: block;
        }
        
        .stats-label {
            font-size: 0.9em;
            opacity: 0.9;
        }
        
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #E91E63;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .timeout-simulation {
            background: #fff3cd;
            border: 2px solid #ffc107;
            border-radius: 10px;
            padding: 20px;
            margin: 15px 0;
        }
        
        .timeout-simulation h4 {
            color: #856404;
            margin-top: 0;
        }
        
        .scenario-description {
            background: #e7f3ff;
            border: 1px solid #b3d4fc;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ• AIèŠå¤©è¶…æ—¶å¤„ç†æµ‹è¯•</h1>
        
        <div class="stats-panel">
            <div class="stats-item">
                <span id="testCount" class="stats-value">0</span>
                <span class="stats-label">æµ‹è¯•æ¬¡æ•°</span>
            </div>
            <div class="stats-item">
                <span id="successCount" class="stats-value">0</span>
                <span class="stats-label">æˆåŠŸæ¬¡æ•°</span>
            </div>
            <div class="stats-item">
                <span id="timeoutCount" class="stats-value">0</span>
                <span class="stats-label">è¶…æ—¶æ¬¡æ•°</span>
            </div>
            <div class="stats-item">
                <span id="avgResponseTime" class="stats-value">0ms</span>
                <span class="stats-label">å¹³å‡å“åº”æ—¶é—´</span>
            </div>
        </div>

        <div class="test-section">
            <h3>ğŸš€ åŸºç¡€AIèŠå¤©æµ‹è¯•</h3>
            <div class="scenario-description">
                æµ‹è¯•æ­£å¸¸AIèŠå¤©åŠŸèƒ½ï¼ŒéªŒè¯å“åº”æ—¶é—´å’ŒæˆåŠŸç‡
            </div>
            <button class="test-button" onclick="testBasicChat()">æ­£å¸¸èŠå¤©æµ‹è¯•</button>
            <button class="test-button" onclick="testComplexChat()">å¤æ‚é—®é¢˜æµ‹è¯•</button>
            <button class="test-button" onclick="testSimpleChat()">ç®€å•é—®é¢˜æµ‹è¯•</button>
            <div id="basicChatResult" class="result-area"></div>
        </div>

        <div class="test-section">
            <h3>â° è¶…æ—¶å¤„ç†é€»è¾‘æµ‹è¯•</h3>
            <div class="scenario-description">
                æ¨¡æ‹ŸAIå“åº”è¶…æ—¶åœºæ™¯ï¼ŒéªŒè¯æ™ºèƒ½æŒ‡å¼•åŠŸèƒ½æ˜¯å¦æ­£å¸¸å·¥ä½œ
            </div>
            <button class="test-button" onclick="testTimeoutHandling()">æ¨¡æ‹Ÿè¶…æ—¶å¤„ç†</button>
            <button class="test-button" onclick="testRepeatedTimeout()">è¿ç»­è¶…æ—¶æµ‹è¯•</button>
            <button class="test-button" onclick="testSmartGuidance()">æ™ºèƒ½æŒ‡å¼•æµ‹è¯•</button>
            <div id="timeoutResult" class="result-area"></div>
        </div>

        <div class="test-section">
            <h3>ğŸ”— ç½‘ç»œå¼‚å¸¸å¤„ç†æµ‹è¯•</h3>
            <div class="scenario-description">
                æµ‹è¯•ç½‘ç»œè¿æ¥å¼‚å¸¸æ—¶çš„ç¦»çº¿æŒ‡å¼•å’Œé”™è¯¯å¤„ç†æœºåˆ¶
            </div>
            <button class="test-button" onclick="testNetworkError()">ç½‘ç»œé”™è¯¯æµ‹è¯•</button>
            <button class="test-button" onclick="testOfflineGuidance()">ç¦»çº¿æŒ‡å¼•æµ‹è¯•</button>
            <div id="networkErrorResult" class="result-area"></div>
        </div>

        <div class="timeout-simulation">
            <h4>âš™ï¸ è¶…æ—¶æ¨¡æ‹Ÿé…ç½®</h4>
            <label>
                è¶…æ—¶æ—¶é—´è®¾ç½®ï¼š
                <select id="timeoutSettings">
                    <option value="1000">1ç§’ï¼ˆå¿«é€Ÿè¶…æ—¶ï¼‰</option>
                    <option value="2000">2ç§’ï¼ˆæµ‹è¯•è¶…æ—¶ï¼‰</option>
                    <option value="5000" selected>5ç§’ï¼ˆæ­£å¸¸è¶…æ—¶ï¼‰</option>
                    <option value="10000">10ç§’ï¼ˆå®½æ¾è¶…æ—¶ï¼‰</option>
                </select>
            </label>
            <br><br>
            <label>
                æµ‹è¯•åœºæ™¯ï¼š
                <select id="testScenario">
                    <option value="normal">æ­£å¸¸å­¦ä¹ åœºæ™¯</option>
                    <option value="difficult">å›°éš¾é¢˜ç›®åœºæ™¯</option>
                    <option value="beginner">åˆå­¦è€…åœºæ™¯</option>
                    <option value="advanced">é«˜çº§å­¦ä¹ åœºæ™¯</option>
                </select>
            </label>
        </div>

        <div class="test-section">
            <h3>ğŸ“Š å‹åŠ›æµ‹è¯•</h3>
            <div class="scenario-description">
                æ¨¡æ‹Ÿé«˜é¢‘è¯·æ±‚å’Œå¹¶å‘åœºæ™¯ï¼Œæµ‹è¯•ç³»ç»Ÿç¨³å®šæ€§
            </div>
            <button class="test-button" onclick="testConcurrentRequests()">å¹¶å‘è¯·æ±‚æµ‹è¯•</button>
            <button class="test-button" onclick="testHighFrequency()">é«˜é¢‘è¯·æ±‚æµ‹è¯•</button>
            <button class="test-button" onclick="clearStats()">æ¸…é™¤ç»Ÿè®¡</button>
            <div id="stressTestResult" class="result-area"></div>
        </div>
    </div>

    <script>
        let testStats = {
            testCount: 0,
            successCount: 0,
            timeoutCount: 0,
            totalResponseTime: 0,
            errors: []
        };

        const API_BASE = 'http://192.168.31.180:3000';

        function updateStats() {
            document.getElementById('testCount').textContent = testStats.testCount;
            document.getElementById('successCount').textContent = testStats.successCount;
            document.getElementById('timeoutCount').textContent = testStats.timeoutCount;
            const avgTime = testStats.testCount > 0 ? Math.round(testStats.totalResponseTime / testStats.testCount) : 0;
            document.getElementById('avgResponseTime').textContent = avgTime + 'ms';
        }

        function logResult(elementId, message, type = 'info') {
            const element = document.getElementById(elementId);
            const timestamp = new Date().toLocaleTimeString();
            const logMessage = `[${timestamp}] ${message}\n`;
            element.textContent += logMessage;
            element.className = `result-area ${type}`;
            element.scrollTop = element.scrollHeight;
        }

        function clearResult(elementId) {
            document.getElementById(elementId).textContent = '';
            document.getElementById(elementId).className = 'result-area';
        }

        async function makeAIRequest(url, data, timeout = 5000) {
            const controller = new AbortController();
            const timeoutId = setTimeout(() => controller.abort(), timeout);
            
            const startTime = Date.now();
            
            try {
                const response = await fetch(`${API_BASE}${url}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data),
                    signal: controller.signal
                });
                
                clearTimeout(timeoutId);
                const responseTime = Date.now() - startTime;
                
                testStats.testCount++;
                testStats.totalResponseTime += responseTime;
                
                if (response.ok) {
                    testStats.successCount++;
                    const result = await response.json();
                    return { success: true, data: result, responseTime };
                } else {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
            } catch (error) {
                clearTimeout(timeoutId);
                const responseTime = Date.now() - startTime;
                testStats.testCount++;
                testStats.totalResponseTime += responseTime;
                
                if (error.name === 'AbortError') {
                    testStats.timeoutCount++;
                    return { success: false, error: 'REQUEST_TIMEOUT', responseTime, timeout };
                } else {
                    testStats.errors.push(error.message);
                    return { success: false, error: error.message, responseTime };
                }
            }
        }

        async function testBasicChat() {
            clearResult('basicChatResult');
            logResult('basicChatResult', 'ğŸš€ å¼€å§‹åŸºç¡€AIèŠå¤©æµ‹è¯•...', 'info');
            
            const testCases = [
                {
                    name: 'ç®€å•æ•°å­¦é—®é¢˜',
                    data: {
                        question: '1+1ç­‰äºå¤šå°‘ï¼Ÿ',
                        subject: 'math',
                        grade: 1,
                        studentInput: 'æˆ‘ä¸çŸ¥é“',
                        chatHistory: [],
                        currentStep: 'understanding'
                    }
                },
                {
                    name: 'è¯­æ–‡é—®é¢˜',
                    data: {
                        question: 'æ˜¥å¤©æœ‰ä»€ä¹ˆç‰¹ç‚¹ï¼Ÿ',
                        subject: 'chinese',
                        grade: 2,
                        studentInput: 'æ˜¥å¤©å¾ˆç¾',
                        chatHistory: [],
                        currentStep: 'understanding'
                    }
                }
            ];

            for (const testCase of testCases) {
                logResult('basicChatResult', `æµ‹è¯•ï¼š${testCase.name}`, 'info');
                
                const result = await makeAIRequest('/api/ai-chat/tutoring', testCase.data);
                
                if (result.success) {
                    logResult('basicChatResult', 
                        `âœ… æˆåŠŸï¼å“åº”æ—¶é—´: ${result.responseTime}ms\nå›å¤: ${result.data.data?.aiResponse || 'N/A'}`, 
                        'success');
                } else {
                    logResult('basicChatResult', 
                        `âŒ å¤±è´¥ï¼é”™è¯¯: ${result.error}, å“åº”æ—¶é—´: ${result.responseTime}ms`, 
                        'error');
                }
            }
            
            updateStats();
        }

        async function testComplexChat() {
            clearResult('basicChatResult');
            logResult('basicChatResult', 'ğŸ§® å¼€å§‹å¤æ‚é—®é¢˜æµ‹è¯•...', 'info');
            
            const complexQuestion = {
                question: 'å°æ˜æœ‰5ä¸ªè‹¹æœï¼Œå°çº¢æœ‰3ä¸ªè‹¹æœï¼Œå¦‚æœå°æ˜ç»™å°çº¢2ä¸ªè‹¹æœï¼Œé‚£ä¹ˆå°æ˜å’Œå°çº¢å„æœ‰å¤šå°‘ä¸ªè‹¹æœï¼Ÿè¯·è¯¦ç»†è¯´æ˜è§£é¢˜è¿‡ç¨‹ã€‚',
                subject: 'math',
                grade: 3,
                studentInput: 'æˆ‘è§‰å¾—è¿™é“é¢˜å¾ˆå¤æ‚ï¼Œä¸çŸ¥é“æ€ä¹ˆå¼€å§‹æ€è€ƒï¼Œèƒ½ç»™æˆ‘ä¸€äº›æç¤ºå—ï¼Ÿè€å¸ˆï¼Œè¿™é“é¢˜æ¶‰åŠåˆ°åŠ æ³•å’Œå‡æ³•ï¼Œæˆ‘éœ€è¦åˆ†æ­¥éª¤æ¥è§£å†³ã€‚',
                chatHistory: [],
                currentStep: 'understanding'
            };

            const result = await makeAIRequest('/api/ai-chat/tutoring', complexQuestion, 8000); // 8ç§’è¶…æ—¶
            
            if (result.success) {
                logResult('basicChatResult', 
                    `âœ… å¤æ‚é—®é¢˜å¤„ç†æˆåŠŸï¼å“åº”æ—¶é—´: ${result.responseTime}ms\nå›å¤: ${result.data.data?.aiResponse || 'N/A'}`, 
                    'success');
            } else if (result.error === 'REQUEST_TIMEOUT') {
                logResult('basicChatResult', 
                    `â° å¤æ‚é—®é¢˜è¶…æ—¶ï¼ˆ${result.timeout}msï¼‰ï¼Œè¿™æ˜¯æ­£å¸¸çš„ï¼Œåº”è¯¥è§¦å‘æ™ºèƒ½æŒ‡å¼•`, 
                    'warning');
            } else {
                logResult('basicChatResult', 
                    `âŒ å¤æ‚é—®é¢˜å¤„ç†å¤±è´¥ï¼é”™è¯¯: ${result.error}`, 
                    'error');
            }
            
            updateStats();
        }

        async function testSimpleChat() {
            clearResult('basicChatResult');
            logResult('basicChatResult', 'âš¡ å¼€å§‹ç®€å•é—®é¢˜æµ‹è¯•...', 'info');
            
            const simpleQuestions = [
                { input: 'æ˜¯', expected: 'å¿«é€Ÿå“åº”' },
                { input: 'å¯¹', expected: 'å¿«é€Ÿå“åº”' },
                { input: 'ä¸æ˜¯', expected: 'å¿«é€Ÿå“åº”' },
                { input: 'çŸ¥é“äº†', expected: 'å¿«é€Ÿå“åº”' },
                { input: 'è°¢è°¢', expected: 'å¿«é€Ÿå“åº”' }
            ];

            for (const q of simpleQuestions) {
                const testData = {
                    question: '1+1ç­‰äº2å—ï¼Ÿ',
                    subject: 'math',
                    grade: 1,
                    studentInput: q.input,
                    chatHistory: [],
                    currentStep: 'understanding'
                };

                const result = await makeAIRequest('/api/ai-chat/tutoring', testData, 3000); // 3ç§’è¶…æ—¶
                
                if (result.success) {
                    const responseTime = result.responseTime;
                    const speed = responseTime < 2000 ? 'âš¡å¿«é€Ÿ' : responseTime < 5000 ? 'ğŸŒä¸€èˆ¬' : 'ğŸ¢è¾ƒæ…¢';
                    logResult('basicChatResult', 
                        `âœ… è¾“å…¥"${q.input}": ${speed} (${responseTime}ms)`, 
                        'success');
                } else {
                    logResult('basicChatResult', 
                        `âŒ è¾“å…¥"${q.input}": å¤±è´¥ - ${result.error}`, 
                        'error');
                }
            }
            
            updateStats();
        }

        async function testTimeoutHandling() {
            clearResult('timeoutResult');
            logResult('timeoutResult', 'â° å¼€å§‹è¶…æ—¶å¤„ç†æµ‹è¯•...', 'info');
            
            const timeoutMs = parseInt(document.getElementById('timeoutSettings').value);
            const scenario = document.getElementById('testScenario').value;
            
            // æ•…æ„ä½¿ç”¨å¾ˆçŸ­çš„è¶…æ—¶æ—¶é—´æ¥è§¦å‘è¶…æ—¶
            const testData = {
                question: 'è¿™æ˜¯ä¸€é“éœ€è¦æ·±å…¥æ€è€ƒçš„å¤æ‚æ•°å­¦åº”ç”¨é¢˜ï¼Œæ¶‰åŠå¤šä¸ªæ­¥éª¤çš„è®¡ç®—å’Œé€»è¾‘æ¨ç†ï¼Œè¯·è¯¦ç»†åˆ†æè§£é¢˜æ€è·¯ã€‚',
                subject: 'math',
                grade: 4,
                studentInput: 'è¿™é“é¢˜å¤ªéš¾äº†ï¼Œæˆ‘å®Œå…¨ä¸çŸ¥é“ä»å“ªé‡Œå¼€å§‹ï¼Œè€å¸ˆèƒ½å¸®å¸®æˆ‘å—ï¼Ÿæˆ‘éœ€è¦è¯¦ç»†çš„æŒ‡å¯¼å’Œåˆ†æ­¥éª¤çš„è§£é‡Šã€‚',
                chatHistory: [],
                currentStep: 'understanding'
            };

            logResult('timeoutResult', `è®¾ç½®è¶…æ—¶æ—¶é—´: ${timeoutMs}ms`, 'info');
            logResult('timeoutResult', `æµ‹è¯•åœºæ™¯: ${scenario}`, 'info');
            
            const result = await makeAIRequest('/api/ai-chat/tutoring', testData, timeoutMs);
            
            if (result.success) {
                logResult('timeoutResult', 
                    `âœ… è¯·æ±‚æˆåŠŸï¼ˆå“åº”æ—¶é—´: ${result.responseTime}msï¼‰\nè¿™æ„å‘³ç€æ²¡æœ‰è§¦å‘è¶…æ—¶å¤„ç†`, 
                    'success');
            } else if (result.error === 'REQUEST_TIMEOUT') {
                logResult('timeoutResult', 
                    `â° æˆåŠŸè§¦å‘è¶…æ—¶ï¼(${result.responseTime}ms > ${timeoutMs}ms)\nâœ¨ æœŸæœ›è¡Œä¸ºï¼šå°ç¨‹åºåº”è‡ªåŠ¨æä¾›æ™ºèƒ½æŒ‡å¼•è€Œä¸æ˜¯æ˜¾ç¤ºé”™è¯¯`, 
                    'warning');
                
                // æµ‹è¯•æ™ºèƒ½æŒ‡å¼•API
                setTimeout(() => {
                    testSmartGuidanceAfterTimeout(testData);
                }, 1000);
                
            } else {
                logResult('timeoutResult', 
                    `âŒ å…¶ä»–é”™è¯¯: ${result.error}`, 
                    'error');
            }
            
            updateStats();
        }

        async function testSmartGuidanceAfterTimeout(originalData) {
            logResult('timeoutResult', '\nğŸ§  æµ‹è¯•è¶…æ—¶åçš„æ™ºèƒ½æŒ‡å¼•...', 'info');
            
            // æµ‹è¯•hint APIï¼ˆåº”è¯¥æ›´å¿«å“åº”ï¼‰
            const hintData = {
                question: originalData.question,
                context: `å­¦ç”Ÿè¯´: "${originalData.studentInput}", è¯·æä¾›æ€è·¯æŒ‡å¼•`,
                subject: originalData.subject,
                grade: originalData.grade
            };

            const hintResult = await makeAIRequest('/api/ai-chat/hint', hintData, 2000); // 2ç§’å¿«é€Ÿè¶…æ—¶
            
            if (hintResult.success) {
                logResult('timeoutResult', 
                    `âœ… æ™ºèƒ½æŒ‡å¼•æˆåŠŸï¼å“åº”æ—¶é—´: ${hintResult.responseTime}ms\næŒ‡å¼•å†…å®¹: ${hintResult.data.data?.hint || 'N/A'}`, 
                    'success');
            } else {
                logResult('timeoutResult', 
                    `âš ï¸ æ™ºèƒ½æŒ‡å¼•ä¹Ÿè¶…æ—¶ï¼Œåº”ä½¿ç”¨æœ¬åœ°æŒ‡å¼•ç­–ç•¥`, 
                    'warning');
            }
        }

        async function testRepeatedTimeout() {
            clearResult('timeoutResult');
            logResult('timeoutResult', 'ğŸ”„ å¼€å§‹è¿ç»­è¶…æ—¶æµ‹è¯•...', 'info');
            
            const shortTimeout = 1000; // 1ç§’è¶…æ—¶ï¼Œå¾ˆå®¹æ˜“è§¦å‘
            
            for (let i = 1; i <= 3; i++) {
                logResult('timeoutResult', `ç¬¬${i}æ¬¡è¯·æ±‚...`, 'info');
                
                const testData = {
                    question: `è¿™æ˜¯ç¬¬${i}æ¬¡å¤æ‚çš„æ•°å­¦é—®é¢˜ï¼Œéœ€è¦æ·±å…¥åˆ†æå’Œè®¡ç®—ã€‚`,
                    subject: 'math',
                    grade: 3,
                    studentInput: `ç¬¬${i}æ¬¡å°è¯•ï¼Œæˆ‘è¿˜æ˜¯ä¸å¤ªç†è§£`,
                    chatHistory: [],
                    currentStep: 'understanding'
                };

                const result = await makeAIRequest('/api/ai-chat/tutoring', testData, shortTimeout);
                
                if (result.error === 'REQUEST_TIMEOUT') {
                    logResult('timeoutResult', 
                        `â° ç¬¬${i}æ¬¡è¶…æ—¶ - åº”é˜²æ­¢é‡å¤æé†’`, 
                        'warning');
                } else if (result.success) {
                    logResult('timeoutResult', 
                        `âœ… ç¬¬${i}æ¬¡æˆåŠŸ (${result.responseTime}ms)`, 
                        'success');
                } else {
                    logResult('timeoutResult', 
                        `âŒ ç¬¬${i}æ¬¡å¤±è´¥: ${result.error}`, 
                        'error');
                }
                
                // é—´éš”1ç§’
                await new Promise(resolve => setTimeout(resolve, 1000));
            }
            
            logResult('timeoutResult', '\nğŸ“Š è¿ç»­è¶…æ—¶æµ‹è¯•å®Œæˆï¼Œæ£€æŸ¥æ˜¯å¦æœ‰é‡å¤çš„è¶…æ—¶æé†’', 'info');
            updateStats();
        }

        async function testSmartGuidance() {
            clearResult('timeoutResult');
            logResult('timeoutResult', 'ğŸ’¡ å¼€å§‹æ™ºèƒ½æŒ‡å¼•åŠŸèƒ½æµ‹è¯•...', 'info');
            
            const guidanceTests = [
                {
                    name: 'æ•°å­¦åŠ æ³•æŒ‡å¼•',
                    data: {
                        question: '3 + 5 = ?',
                        context: 'å­¦ç”Ÿè¯´: "æˆ‘ä¸çŸ¥é“æ€ä¹ˆç®—", è¯·æä¾›æ€è·¯æŒ‡å¼•',
                        subject: 'math',
                        grade: 1
                    }
                },
                {
                    name: 'å¤æ‚åº”ç”¨é¢˜æŒ‡å¼•',
                    data: {
                        question: 'å°æ˜ä¹°äº†3æ”¯ç¬”ï¼Œæ¯æ”¯ç¬”2å…ƒï¼Œä»–ä¸€å…±èŠ±äº†å¤šå°‘é’±ï¼Ÿ',
                        context: 'å­¦ç”Ÿè¯´: "æˆ‘çœ‹ä¸æ‡‚è¿™é“é¢˜", è¯·æä¾›æ€è·¯æŒ‡å¼•',
                        subject: 'math',
                        grade: 2
                    }
                }
            ];

            for (const test of guidanceTests) {
                logResult('timeoutResult', `æµ‹è¯•ï¼š${test.name}`, 'info');
                
                const result = await makeAIRequest('/api/ai-chat/hint', test.data, 3000);
                
                if (result.success) {
                    logResult('timeoutResult', 
                        `âœ… æŒ‡å¼•æˆåŠŸï¼å“åº”æ—¶é—´: ${result.responseTime}ms\næŒ‡å¼•: ${result.data.data?.hint || 'N/A'}`, 
                        'success');
                } else {
                    logResult('timeoutResult', 
                        `âŒ æŒ‡å¼•å¤±è´¥: ${result.error}`, 
                        'error');
                }
            }
            
            updateStats();
        }

        async function testNetworkError() {
            clearResult('networkErrorResult');
            logResult('networkErrorResult', 'ğŸ”— å¼€å§‹ç½‘ç»œé”™è¯¯æµ‹è¯•...', 'info');
            
            // æµ‹è¯•æ— æ•ˆURL
            const invalidTests = [
                { url: '/api/ai-chat/invalid', name: 'æ— æ•ˆç«¯ç‚¹æµ‹è¯•' },
                { url: '/api/nonexistent', name: 'ä¸å­˜åœ¨çš„APIæµ‹è¯•' }
            ];

            for (const test of invalidTests) {
                logResult('networkErrorResult', `æµ‹è¯•ï¼š${test.name}`, 'info');
                
                try {
                    const response = await fetch(`${API_BASE}${test.url}`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ test: 'data' })
                    });
                    
                    if (!response.ok) {
                        logResult('networkErrorResult', 
                            `âœ… æ­£ç¡®å¤„ç†HTTPé”™è¯¯: ${response.status} ${response.statusText}`, 
                            'warning');
                    }
                } catch (error) {
                    logResult('networkErrorResult', 
                        `âœ… æ­£ç¡®æ•è·ç½‘ç»œé”™è¯¯: ${error.message}`, 
                        'warning');
                }
            }
            
            // æµ‹è¯•é”™è¯¯çš„æœåŠ¡å™¨åœ°å€
            logResult('networkErrorResult', 'æµ‹è¯•ï¼šé”™è¯¯æœåŠ¡å™¨åœ°å€', 'info');
            try {
                const response = await fetch('http://192.168.1.999:3000/api/ai-chat/tutoring', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ test: 'data' }),
                    signal: AbortSignal.timeout(2000)
                });
            } catch (error) {
                logResult('networkErrorResult', 
                    `âœ… æ­£ç¡®å¤„ç†ç½‘ç»œè¿æ¥é”™è¯¯: ${error.message}`, 
                    'warning');
            }
        }

        async function testOfflineGuidance() {
            clearResult('networkErrorResult');
            logResult('networkErrorResult', 'ğŸ“± ç¦»çº¿æŒ‡å¼•åŠŸèƒ½æµ‹è¯•...', 'info');
            
            // è¿™é‡Œæˆ‘ä»¬æ¨¡æ‹Ÿç¦»çº¿æŒ‡å¼•çš„é€»è¾‘
            const offlineGuidanceTests = [
                {
                    question: '5 + 3 = ?',
                    expected: 'åº”åŒ…å«åŸºæœ¬åŠ æ³•æŒ‡å¼•'
                },
                {
                    question: '10 - 4 = ?',
                    expected: 'åº”åŒ…å«å‡æ³•æŒ‡å¼•'
                },
                {
                    question: 'å¤æ‚åº”ç”¨é¢˜',
                    expected: 'åº”åŒ…å«é€šç”¨è§£é¢˜æ­¥éª¤'
                }
            ];

            logResult('networkErrorResult', 'ğŸ“ ç¦»çº¿æŒ‡å¼•ç­–ç•¥æµ‹è¯•ï¼ˆå‰ç«¯é€»è¾‘ï¼‰:', 'info');
            
            for (const test of offlineGuidanceTests) {
                // æ¨¡æ‹Ÿç”Ÿæˆç¦»çº¿æŒ‡å¼•çš„é€»è¾‘
                let guidance = generateMockOfflineGuidance(test.question);
                
                logResult('networkErrorResult', 
                    `é¢˜ç›®: "${test.question}"\næŒ‡å¼•: ${guidance}\n`, 
                    'success');
            }
        }

        function generateMockOfflineGuidance(question) {
            let guidance = 'ğŸ“± ç½‘ç»œæš‚æ—¶ä¸ç¨³å®šï¼Œä½¿ç”¨ç¦»çº¿æŒ‡å¼•ï¼š\n\n';
            
            if (question.includes('+') || question.includes('åŠ ')) {
                guidance += 'ğŸ”¢ è¿™æ˜¯åŠ æ³•é¢˜ï¼š\nâ€¢ æ‰¾å‡ºä¸¤ä¸ªè¦ç›¸åŠ çš„æ•°\nâ€¢ å¯ä»¥ç”¨æ‰‹æŒ‡å¸®åŠ©è®¡ç®—\nâ€¢ ä»è¾ƒå¤§çš„æ•°å¼€å§‹æ•°èµ·';
            } else if (question.includes('-') || question.includes('å‡')) {
                guidance += 'â– è¿™æ˜¯å‡æ³•é¢˜ï¼š\nâ€¢ æ‰¾å‡ºè¢«å‡æ•°å’Œå‡æ•°\nâ€¢ æƒ³è±¡ä»ä¸€å †ä¸œè¥¿é‡Œæ‹¿èµ°ä¸€äº›';
            } else {
                guidance += 'ğŸ“š é€šç”¨è§£é¢˜æ­¥éª¤ï¼š\nâ€¢ ä»”ç»†è¯»é¢˜\nâ€¢ æ‰¾å‡ºå·²çŸ¥å’ŒæœªçŸ¥\nâ€¢ é€‰æ‹©åˆé€‚æ–¹æ³•\nâ€¢ åŠ¨æ‰‹è®¡ç®—\nâ€¢ æ£€æŸ¥ç­”æ¡ˆ';
            }
            
            return guidance;
        }

        async function testConcurrentRequests() {
            clearResult('stressTestResult');
            logResult('stressTestResult', 'ğŸš€ å¼€å§‹å¹¶å‘è¯·æ±‚æµ‹è¯•...', 'info');
            
            const concurrentCount = 5;
            const promises = [];
            
            for (let i = 0; i < concurrentCount; i++) {
                const testData = {
                    question: `å¹¶å‘æµ‹è¯•é¢˜ç›® ${i+1}`,
                    subject: 'math',
                    grade: 1,
                    studentInput: `å¹¶å‘è¯·æ±‚ ${i+1}`,
                    chatHistory: [],
                    currentStep: 'understanding'
                };
                
                promises.push(makeAIRequest('/api/ai-chat/tutoring', testData, 10000));
            }
            
            const startTime = Date.now();
            const results = await Promise.allSettled(promises);
            const totalTime = Date.now() - startTime;
            
            let successCount = 0;
            let failureCount = 0;
            
            results.forEach((result, index) => {
                if (result.status === 'fulfilled' && result.value.success) {
                    successCount++;
                    logResult('stressTestResult', 
                        `âœ… å¹¶å‘è¯·æ±‚ ${index+1}: æˆåŠŸ (${result.value.responseTime}ms)`, 
                        'success');
                } else {
                    failureCount++;
                    const error = result.status === 'fulfilled' ? result.value.error : result.reason;
                    logResult('stressTestResult', 
                        `âŒ å¹¶å‘è¯·æ±‚ ${index+1}: å¤±è´¥ - ${error}`, 
                        'error');
                }
            });
            
            logResult('stressTestResult', 
                `\nğŸ“Š å¹¶å‘æµ‹è¯•ç»“æœï¼š\næˆåŠŸ: ${successCount}/${concurrentCount}\nå¤±è´¥: ${failureCount}/${concurrentCount}\næ€»è€—æ—¶: ${totalTime}ms`, 
                'info');
            
            updateStats();
        }

        async function testHighFrequency() {
            clearResult('stressTestResult');
            logResult('stressTestResult', 'âš¡ å¼€å§‹é«˜é¢‘è¯·æ±‚æµ‹è¯•...', 'info');
            
            const requestCount = 10;
            const interval = 500; // 500msé—´éš”
            
            for (let i = 0; i < requestCount; i++) {
                const testData = {
                    question: `é«˜é¢‘æµ‹è¯• ${i+1}`,
                    subject: 'math',
                    grade: 1,
                    studentInput: `é«˜é¢‘è¯·æ±‚ ${i+1}`,
                    chatHistory: [],
                    currentStep: 'understanding'
                };
                
                logResult('stressTestResult', `å‘é€ç¬¬ ${i+1} ä¸ªè¯·æ±‚...`, 'info');
                
                const result = await makeAIRequest('/api/ai-chat/tutoring', testData, 5000);
                
                if (result.success) {
                    logResult('stressTestResult', 
                        `âœ… è¯·æ±‚ ${i+1}: æˆåŠŸ (${result.responseTime}ms)`, 
                        'success');
                } else {
                    logResult('stressTestResult', 
                        `âŒ è¯·æ±‚ ${i+1}: å¤±è´¥ - ${result.error}`, 
                        'error');
                }
                
                // ç­‰å¾…é—´éš”
                if (i < requestCount - 1) {
                    await new Promise(resolve => setTimeout(resolve, interval));
                }
            }
            
            logResult('stressTestResult', '\nğŸ“Š é«˜é¢‘æµ‹è¯•å®Œæˆ', 'info');
            updateStats();
        }

        function clearStats() {
            testStats = {
                testCount: 0,
                successCount: 0,
                timeoutCount: 0,
                totalResponseTime: 0,
                errors: []
            };
            updateStats();
            
            // æ¸…é™¤æ‰€æœ‰ç»“æœåŒºåŸŸ
            ['basicChatResult', 'timeoutResult', 'networkErrorResult', 'stressTestResult'].forEach(id => {
                clearResult(id);
            });
        }

        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            updateStats();
            
            // æ·»åŠ ä¸€äº›è¯´æ˜ä¿¡æ¯
            logResult('basicChatResult', 'å‡†å¤‡è¿›è¡ŒAIèŠå¤©åŸºç¡€åŠŸèƒ½æµ‹è¯•...', 'info');
            logResult('timeoutResult', 'å‡†å¤‡è¿›è¡Œè¶…æ—¶å¤„ç†æµ‹è¯•...', 'info');
            logResult('networkErrorResult', 'å‡†å¤‡è¿›è¡Œç½‘ç»œå¼‚å¸¸å¤„ç†æµ‹è¯•...', 'info');
            logResult('stressTestResult', 'å‡†å¤‡è¿›è¡Œå‹åŠ›æµ‹è¯•...', 'info');
        });
    </script>
</body>
</html> 