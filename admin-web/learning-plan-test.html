<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å­¦ä¹ è®¡åˆ’ç”Ÿæˆæµ‹è¯• - å°å­¦AIå®¶æ•™</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .test-section {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }

        .test-title {
            color: #333;
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
            padding-bottom: 10px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            font-weight: 500;
            margin-bottom: 5px;
            color: #555;
        }

        textarea, select, input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
        }

        textarea {
            height: 120px;
            resize: vertical;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
            margin: 5px;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5a67d8;
        }

        .btn-secondary {
            background: #f7fafc;
            color: #4a5568;
            border: 1px solid #e2e8f0;
        }

        .btn-secondary:hover {
            background: #edf2f7;
        }

        .result-area {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 6px;
            padding: 15px;
            margin-top: 15px;
            max-height: 400px;
            overflow-y: auto;
        }

        .status {
            padding: 8px 12px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 500;
            margin-bottom: 10px;
            display: inline-block;
        }

        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .status.loading {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }

        .json-display {
            background: #2d3748;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 6px;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 12px;
            overflow-x: auto;
            white-space: pre-wrap;
        }

        .flex {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        @media (max-width: 768px) {
            .grid {
                grid-template-columns: 1fr;
            }
        }

        .plan-preview {
            background: #f8f9fa;
            border-left: 4px solid #667eea;
            padding: 15px;
            margin: 10px 0;
        }

        .question-item {
            background: white;
            border: 1px solid #e9ecef;
            border-radius: 6px;
            padding: 12px;
            margin: 8px 0;
        }

        .question-meta {
            font-size: 12px;
            color: #6c757d;
            margin-top: 5px;
        }

        .time-allocation {
            display: flex;
            gap: 5px;
            flex-wrap: wrap;
            margin: 10px 0;
        }

        .time-badge {
            background: #e9ecef;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            color: #495057;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ¤– AIå­¦ä¹ è®¡åˆ’ç”Ÿæˆæµ‹è¯•</h1>
            <p>æµ‹è¯•OCRè¯†åˆ«åçš„æ™ºèƒ½å­¦ä¹ è®¡åˆ’ç”ŸæˆåŠŸèƒ½</p>
        </div>

        <!-- åŸºç¡€æµ‹è¯• -->
        <div class="test-section">
            <div class="test-title">ğŸ¯ åŸºç¡€å­¦ä¹ è®¡åˆ’ç”Ÿæˆæµ‹è¯•</div>
            
            <div class="grid">
                <div>
                    <div class="form-group">
                        <label>OCRè¯†åˆ«çš„é¢˜ç›®æ–‡æœ¬ï¼ˆæ¯è¡Œä¸€é¢˜ï¼‰</label>
                        <textarea id="ocrText" placeholder="è¯·è¾“å…¥é¢˜ç›®ï¼Œä¾‹å¦‚ï¼š&#10;3 + 4 = ?&#10;å°æ˜æœ‰5ä¸ªè‹¹æœï¼Œåƒäº†2ä¸ªï¼Œè¿˜å‰©å‡ ä¸ªï¼Ÿ&#10;è®¡ç®—ï¼š8 Ã— 3 = ?">3 + 4 = ?
å°æ˜æœ‰5ä¸ªè‹¹æœï¼Œåƒäº†2ä¸ªï¼Œè¿˜å‰©å‡ ä¸ªï¼Ÿ
è®¡ç®—ï¼š8 Ã— 3 = ?
15 Ã· 3 = ?
å°çº¢ä¹°äº†2æœ¬ä¹¦ï¼Œæ¯æœ¬12å…ƒï¼Œä¸€å…±èŠ±äº†å¤šå°‘é’±ï¼Ÿ</textarea>
                    </div>

                    <div class="flex">
                        <div class="form-group">
                            <label>å­¦ç§‘</label>
                            <select id="subject">
                                <option value="math">æ•°å­¦</option>
                                <option value="chinese">è¯­æ–‡</option>
                                <option value="english">è‹±è¯­</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label>å¹´çº§</label>
                            <select id="grade">
                                <option value="1">ä¸€å¹´çº§</option>
                                <option value="2">äºŒå¹´çº§</option>
                                <option value="3" selected>ä¸‰å¹´çº§</option>
                                <option value="4">å››å¹´çº§</option>
                                <option value="5">äº”å¹´çº§</option>
                                <option value="6">å…­å¹´çº§</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group">
                        <button class="btn btn-primary" onclick="testPlanGeneration()">
                            ğŸš€ ç”Ÿæˆå­¦ä¹ è®¡åˆ’
                        </button>
                        <button class="btn btn-secondary" onclick="clearResults()">
                            ğŸ—‘ï¸ æ¸…ç©ºç»“æœ
                        </button>
                    </div>
                </div>

                <div>
                    <div class="form-group">
                        <label>æµ‹è¯•çŠ¶æ€</label>
                        <div id="testStatus">ç­‰å¾…æµ‹è¯•...</div>
                    </div>

                    <div class="form-group">
                        <label>å­¦ä¹ è®¡åˆ’é¢„è§ˆ</label>
                        <div id="planPreview" class="result-area">
                            ç‚¹å‡»"ç”Ÿæˆå­¦ä¹ è®¡åˆ’"å¼€å§‹æµ‹è¯•
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- AIç»ƒä¹ é¢˜ç”Ÿæˆæµ‹è¯• -->
        <div class="test-section">
            <div class="test-title">ğŸ§  AIç»ƒä¹ é¢˜ç”Ÿæˆæµ‹è¯•</div>
            
            <div class="form-group">
                <button class="btn btn-primary" onclick="testAIPracticeGeneration()">
                    ğŸ¯ æµ‹è¯•AIç»ƒä¹ é¢˜ç”Ÿæˆ
                </button>
                <button class="btn btn-secondary" onclick="testAIChatTutoring()">
                    ğŸ’¬ æµ‹è¯•AIèŠå¤©ç­”ç–‘
                </button>
            </div>

            <div class="result-area" id="aiTestResults">
                ç­‰å¾…AIåŠŸèƒ½æµ‹è¯•...
            </div>
        </div>

        <!-- APIå“åº”è¯¦æƒ… -->
        <div class="test-section">
            <div class="test-title">ğŸ“‹ APIå“åº”è¯¦æƒ…</div>
            <div class="json-display" id="apiResponse">
                ç­‰å¾…APIè°ƒç”¨...
            </div>
        </div>

        <!-- æ€§èƒ½ç»Ÿè®¡ -->
        <div class="test-section">
            <div class="test-title">ğŸ“Š æ€§èƒ½ç»Ÿè®¡</div>
            <div id="performanceStats">
                <div class="flex">
                    <div>å“åº”æ—¶é—´: <span id="responseTime">-</span></div>
                    <div>APIçŠ¶æ€: <span id="apiStatus">-</span></div>
                    <div>æ•°æ®å¤§å°: <span id="dataSize">-</span></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let testResults = [];

        async function testPlanGeneration() {
            const ocrText = document.getElementById('ocrText').value.trim();
            const subject = document.getElementById('subject').value;
            const grade = parseInt(document.getElementById('grade').value);

            if (!ocrText) {
                setStatus('error', 'è¯·è¾“å…¥OCRè¯†åˆ«çš„é¢˜ç›®æ–‡æœ¬');
                return;
            }

            setStatus('loading', 'æ­£åœ¨ç”Ÿæˆå­¦ä¹ è®¡åˆ’...');
            const startTime = Date.now();

            try {
                // å‡†å¤‡è¯·æ±‚æ•°æ®
                const requestData = {
                    ocrText: ocrText.split('\n').filter(line => line.trim()),
                    subject: subject,
                    grade: grade,
                    originalImage: null
                };

                console.log('ğŸ“¤ å‘é€å­¦ä¹ è®¡åˆ’ç”Ÿæˆè¯·æ±‚:', requestData);

                // è°ƒç”¨å­¦ä¹ è®¡åˆ’ç”ŸæˆAPI
                const response = await fetch('/api/plan/create', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(requestData)
                });

                const responseTime = Date.now() - startTime;
                updatePerformanceStats(responseTime, response.status, 0);

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const planData = await response.json();
                console.log('ğŸ“¥ å­¦ä¹ è®¡åˆ’å“åº”:', planData);

                // æ›´æ–°æ€§èƒ½ç»Ÿè®¡
                updatePerformanceStats(responseTime, response.status, JSON.stringify(planData).length);

                // æ˜¾ç¤ºç»“æœ
                displayPlanPreview(planData);
                displayApiResponse(planData);
                setStatus('success', `å­¦ä¹ è®¡åˆ’ç”ŸæˆæˆåŠŸï¼ç”¨æ—¶ ${responseTime}ms`);

                testResults.push({
                    type: 'plan_generation',
                    success: true,
                    responseTime,
                    planId: planData.planId,
                    questionCount: planData.questionCount
                });

            } catch (error) {
                console.error('âŒ å­¦ä¹ è®¡åˆ’ç”Ÿæˆå¤±è´¥:', error);
                setStatus('error', `å­¦ä¹ è®¡åˆ’ç”Ÿæˆå¤±è´¥: ${error.message}`);
                displayApiResponse({ error: error.message });

                testResults.push({
                    type: 'plan_generation',
                    success: false,
                    error: error.message
                });
            }
        }

        async function testAIPracticeGeneration() {
            setStatus('loading', 'æ­£åœ¨æµ‹è¯•AIç»ƒä¹ é¢˜ç”Ÿæˆ...');

            try {
                const response = await fetch('/api/ai-generator/test', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({})
                });

                const result = await response.json();
                document.getElementById('aiTestResults').innerHTML = `
                    <div class="status success">AIç»ƒä¹ é¢˜ç”Ÿæˆæµ‹è¯•æˆåŠŸ</div>
                    <div class="json-display">${JSON.stringify(result, null, 2)}</div>
                `;

                setStatus('success', 'AIç»ƒä¹ é¢˜ç”Ÿæˆæµ‹è¯•å®Œæˆ');

            } catch (error) {
                document.getElementById('aiTestResults').innerHTML = `
                    <div class="status error">AIç»ƒä¹ é¢˜ç”Ÿæˆæµ‹è¯•å¤±è´¥: ${error.message}</div>
                `;
                setStatus('error', 'AIç»ƒä¹ é¢˜ç”Ÿæˆæµ‹è¯•å¤±è´¥');
            }
        }

        async function testAIChatTutoring() {
            setStatus('loading', 'æ­£åœ¨æµ‹è¯•AIèŠå¤©ç­”ç–‘...');

            try {
                const response = await fetch('/api/ai-generator/chat-tutoring', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        question: "3 + 4 = ?",
                        studentInput: "æˆ‘ä¸çŸ¥é“æ€ä¹ˆç®—",
                        urgency: 'normal'
                    })
                });

                const result = await response.json();
                document.getElementById('aiTestResults').innerHTML = `
                    <div class="status success">AIèŠå¤©ç­”ç–‘æµ‹è¯•æˆåŠŸ</div>
                    <div class="json-display">${JSON.stringify(result, null, 2)}</div>
                `;

                setStatus('success', 'AIèŠå¤©ç­”ç–‘æµ‹è¯•å®Œæˆ');

            } catch (error) {
                document.getElementById('aiTestResults').innerHTML = `
                    <div class="status error">AIèŠå¤©ç­”ç–‘æµ‹è¯•å¤±è´¥: ${error.message}</div>
                `;
                setStatus('error', 'AIèŠå¤©ç­”ç–‘æµ‹è¯•å¤±è´¥');
            }
        }

        function displayPlanPreview(planData) {
            const preview = document.getElementById('planPreview');
            
            if (!planData || !planData.questions) {
                preview.innerHTML = '<div class="status error">æ— æ•ˆçš„å­¦ä¹ è®¡åˆ’æ•°æ®</div>';
                return;
            }

            let html = `
                <div class="plan-preview">
                    <h4>ğŸ“‹ å­¦ä¹ è®¡åˆ’æ¦‚è§ˆ</h4>
                    <p><strong>è®¡åˆ’ID:</strong> ${planData.planId}</p>
                    <p><strong>é¢˜ç›®æ•°é‡:</strong> ${planData.questionCount}</p>
                    <p><strong>é¢„è®¡æ€»æ—¶é•¿:</strong> ${planData.estimatedTotalTime} åˆ†é’Ÿ</p>
                    <p><strong>å­¦ç§‘:</strong> ${planData.subject}</p>
                    <p><strong>å¹´çº§:</strong> ${planData.grade}</p>
                </div>
            `;

            if (planData.questions && planData.questions.length > 0) {
                html += '<h5>ğŸ“ é¢˜ç›®åˆ—è¡¨:</h5>';
                planData.questions.forEach((q, index) => {
                    html += `
                        <div class="question-item">
                            <div><strong>é¢˜ç›® ${index + 1}:</strong> ${q.text}</div>
                            <div class="question-meta">
                                æ—¶é—´: ${q.time}åˆ†é’Ÿ | 
                                éš¾åº¦: ${q.difficulty || 'æœªçŸ¥'} | 
                                ç±»å‹: ${q.type || 'æœªçŸ¥'}
                            </div>
                        </div>
                    `;
                });
            }

            if (planData.perQuestionTime && planData.perQuestionTime.length > 0) {
                html += '<h5>â±ï¸ æ—¶é—´åˆ†é…:</h5>';
                html += '<div class="time-allocation">';
                planData.perQuestionTime.forEach((time, index) => {
                    html += `<span class="time-badge">é¢˜ç›®${index + 1}: ${time}åˆ†é’Ÿ</span>`;
                });
                html += '</div>';
            }

            if (planData.learningStrategy) {
                html += `
                    <div class="plan-preview">
                        <h5>ğŸ¯ å­¦ä¹ ç­–ç•¥:</h5>
                        <p>${planData.learningStrategy}</p>
                    </div>
                `;
            }

            if (planData.studyTips && planData.studyTips.length > 0) {
                html += `
                    <div class="plan-preview">
                        <h5>ğŸ’¡ å­¦ä¹ å»ºè®®:</h5>
                        <ul>
                            ${planData.studyTips.map(tip => `<li>${tip}</li>`).join('')}
                        </ul>
                    </div>
                `;
            }

            preview.innerHTML = html;
        }

        function displayApiResponse(data) {
            document.getElementById('apiResponse').textContent = JSON.stringify(data, null, 2);
        }

        function updatePerformanceStats(responseTime, status, dataSize) {
            document.getElementById('responseTime').textContent = `${responseTime}ms`;
            document.getElementById('apiStatus').textContent = status;
            document.getElementById('dataSize').textContent = `${(dataSize / 1024).toFixed(2)}KB`;
        }

        function setStatus(type, message) {
            const statusEl = document.getElementById('testStatus');
            statusEl.className = `status ${type}`;
            statusEl.textContent = message;
        }

        function clearResults() {
            document.getElementById('planPreview').innerHTML = 'ç‚¹å‡»"ç”Ÿæˆå­¦ä¹ è®¡åˆ’"å¼€å§‹æµ‹è¯•';
            document.getElementById('apiResponse').textContent = 'ç­‰å¾…APIè°ƒç”¨...';
            document.getElementById('aiTestResults').innerHTML = 'ç­‰å¾…AIåŠŸèƒ½æµ‹è¯•...';
            setStatus('', 'ç­‰å¾…æµ‹è¯•...');
            testResults = [];
        }

        // é¡µé¢åŠ è½½å®Œæˆåæ£€æŸ¥æœåŠ¡å™¨çŠ¶æ€
        document.addEventListener('DOMContentLoaded', async function() {
            try {
                const response = await fetch('/api/health');
                const health = await response.json();
                setStatus('success', `æœåŠ¡å™¨æ­£å¸¸è¿è¡Œ - ${health.message}`);
            } catch (error) {
                setStatus('error', 'æœåŠ¡å™¨è¿æ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥åç«¯æœåŠ¡');
            }
        });
    </script>
</body>
</html> 