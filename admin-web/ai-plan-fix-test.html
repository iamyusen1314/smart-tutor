<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AIå­¦ä¹ è®¡åˆ’ä¿®å¤æµ‹è¯•</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
            margin: 20px;
            background: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .title {
            text-align: center;
            color: #333;
            margin-bottom: 30px;
        }
        .fix-summary {
            background: #e8f5e8;
            border: 1px solid #4caf50;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 30px;
        }
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        .test-form {
            display: grid;
            gap: 15px;
            margin-bottom: 20px;
        }
        .form-group {
            display: flex;
            flex-direction: column;
        }
        label {
            font-weight: bold;
            margin-bottom: 5px;
            color: #333;
        }
        input, select, textarea {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        textarea {
            min-height: 100px;
            resize: vertical;
        }
        .button-group {
            display: flex;
            gap: 10px;
            margin: 20px 0;
        }
        button {
            padding: 12px 24px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
        }
        .btn-primary {
            background: #007bff;
            color: white;
        }
        .btn-success {
            background: #28a745;
            color: white;
        }
        .btn-warning {
            background: #ffc107;
            color: #333;
        }
        .btn-danger {
            background: #dc3545;
            color: white;
        }
        button:hover {
            opacity: 0.9;
        }
        .result-section {
            margin-top: 20px;
        }
        .status {
            padding: 15px;
            border-radius: 4px;
            margin-bottom: 15px;
            font-weight: bold;
        }
        .status.success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        .status.error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        .status.loading {
            background: #d1ecf1;
            border: 1px solid #bee5eb;
            color: #0c5460;
        }
        .json-display {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            padding: 15px;
            font-family: 'Monaco', 'Courier New', monospace;
            font-size: 12px;
            white-space: pre-wrap;
            word-break: break-all;
            max-height: 400px;
            overflow-y: auto;
        }
        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        .comparison-table th,
        .comparison-table td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: left;
        }
        .comparison-table th {
            background: #f8f9fa;
            font-weight: bold;
        }
        .before {
            background: #fff3cd;
        }
        .after {
            background: #d4edda;
        }
        .test-examples {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 4px;
            margin-bottom: 20px;
        }
        .example-item {
            margin-bottom: 10px;
            padding: 10px;
            background: white;
            border-left: 4px solid #007bff;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="title">ğŸ”§ AIå­¦ä¹ è®¡åˆ’ä¿®å¤æµ‹è¯•</h1>
        
        <div class="fix-summary">
            <h3>ğŸ¯ ä¿®å¤å†…å®¹æ€»ç»“</h3>
            <ul>
                <li><strong>é—®é¢˜1è§£å†³</strong>ï¼šAIèŠå¤©æ˜¾ç¤º"ç¤ºä¾‹é¢˜ç›®1"è€Œä¸æ˜¯çœŸå®é¢˜ç›®</li>
                <li><strong>é—®é¢˜2è§£å†³</strong>ï¼šAIå­¦ä¹ è®¡åˆ’ç”Ÿæˆè¶…æ—¶ä¼˜åŒ–ï¼ˆ25ç§’â†’12ç§’ï¼‰</li>
                <li><strong>æ ¸å¿ƒä¿®å¤</strong>ï¼šå³ä½¿AIè°ƒç”¨å¤±è´¥ï¼Œä¹Ÿä½¿ç”¨OCRè¯†åˆ«çš„çœŸå®é¢˜ç›®å†…å®¹</li>
                <li><strong>æ€§èƒ½ä¼˜åŒ–</strong>ï¼šä½¿ç”¨qwen-turboæ¨¡å‹æå‡å“åº”é€Ÿåº¦</li>
                <li><strong>fallbackæ”¹è¿›</strong>ï¼šæ™ºèƒ½åˆ†æçœŸå®é¢˜ç›®ç±»å‹å’Œéš¾åº¦</li>
            </ul>
        </div>

        <!-- ä¿®å¤å‰åå¯¹æ¯” -->
        <div class="test-section">
            <h3>ğŸ“Š ä¿®å¤å‰åå¯¹æ¯”</h3>
            <table class="comparison-table">
                <thead>
                    <tr>
                        <th>é—®é¢˜é¡¹</th>
                        <th class="before">ä¿®å¤å‰</th>
                        <th class="after">ä¿®å¤å</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>AIèŠå¤©å†…å®¹</td>
                        <td class="before">æ˜¾ç¤º"ç¤ºä¾‹é¢˜ç›®1"ç­‰æ¨¡æ‹Ÿæ•°æ®</td>
                        <td class="after">æ˜¾ç¤ºOCRè¯†åˆ«çš„çœŸå®é¢˜ç›®</td>
                    </tr>
                    <tr>
                        <td>å­¦ä¹ è®¡åˆ’è¶…æ—¶</td>
                        <td class="before">25ç§’ï¼Œç»å¸¸è¶…æ—¶</td>
                        <td class="after">12ç§’ï¼Œä½¿ç”¨æœ€å¿«æ¨¡å‹</td>
                    </tr>
                    <tr>
                        <td>å¤±è´¥å¤„ç†</td>
                        <td class="before">fallbackä½¿ç”¨ç¤ºä¾‹é¢˜ç›®</td>
                        <td class="after">fallbackä½¿ç”¨çœŸå®OCRé¢˜ç›®</td>
                    </tr>
                    <tr>
                        <td>ç”¨æˆ·ä½“éªŒ</td>
                        <td class="before">ä»¤äººå›°æƒ‘å’Œæ²®ä¸§</td>
                        <td class="after">çœŸå®ã€å¯é ã€å¿«é€Ÿ</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- æµ‹è¯•ç”¨ä¾‹ -->
        <div class="test-section">
            <h3>ğŸ§ª å­¦ä¹ è®¡åˆ’ç”Ÿæˆæµ‹è¯•</h3>
            
            <div class="test-examples">
                <h4>æµ‹è¯•ç”¨ä¾‹ç¤ºä¾‹</h4>
                <div class="example-item">
                    <strong>æ•°å­¦è®¡ç®—é¢˜ï¼š</strong>3+5=?, 8-4=?, 6Ã—2=?, 12Ã·3=?
                </div>
                <div class="example-item">
                    <strong>åº”ç”¨é¢˜ï¼š</strong>å°æ˜æœ‰24ä¸ªè‹¹æœï¼Œè¦å¹³å‡åˆ†ç»™6ä¸ªæœ‹å‹ï¼Œæ¯ä¸ªæœ‹å‹åˆ†åˆ°å‡ ä¸ªï¼Ÿ
                </div>
                <div class="example-item">
                    <strong>æ··åˆé¢˜ç›®ï¼š</strong>15+8=?, å°çº¢ä¹°äº†3æ”¯ç¬”ï¼Œæ¯æ”¯2å…ƒï¼Œä¸€å…±èŠ±äº†å¤šå°‘é’±ï¼Ÿ
                </div>
            </div>

            <div class="test-form">
                <div class="form-group">
                    <label for="subject">å­¦ç§‘é€‰æ‹©ï¼š</label>
                    <select id="subject">
                        <option value="math">æ•°å­¦</option>
                        <option value="chinese">è¯­æ–‡</option>
                        <option value="english">è‹±è¯­</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="grade">å¹´çº§é€‰æ‹©ï¼š</label>
                    <select id="grade">
                        <option value="1">ä¸€å¹´çº§</option>
                        <option value="2">äºŒå¹´çº§</option>
                        <option value="3" selected>ä¸‰å¹´çº§</option>
                        <option value="4">å››å¹´çº§</option>
                        <option value="5">äº”å¹´çº§</option>
                        <option value="6">å…­å¹´çº§</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="questions">é¢˜ç›®å†…å®¹ï¼ˆæ¯è¡Œä¸€é¢˜ï¼‰ï¼š</label>
                    <textarea id="questions" placeholder="è¯·è¾“å…¥çœŸå®çš„é¢˜ç›®å†…å®¹ï¼Œæ¯è¡Œä¸€é¢˜ã€‚è¿™å°†æµ‹è¯•å³ä½¿AIå¤±è´¥ï¼Œç³»ç»Ÿä¹Ÿèƒ½åŸºäºè¿™äº›çœŸå®é¢˜ç›®ç”Ÿæˆå­¦ä¹ è®¡åˆ’ã€‚">3+5=?
8-4=?
å°æ˜æœ‰15ä¸ªè‹¹æœï¼Œåƒäº†3ä¸ªï¼Œè¿˜å‰©å‡ ä¸ªï¼Ÿ
6Ã—2=?</textarea>
                </div>
            </div>

            <div class="button-group">
                <button class="btn-primary" onclick="testPlanGeneration()">ğŸš€ æµ‹è¯•å­¦ä¹ è®¡åˆ’ç”Ÿæˆ</button>
                <button class="btn-success" onclick="loadExample('math')">ğŸ“ åŠ è½½æ•°å­¦ç¤ºä¾‹</button>
                <button class="btn-success" onclick="loadExample('mixed')">ğŸ“ åŠ è½½æ··åˆç¤ºä¾‹</button>
                <button class="btn-warning" onclick="testTimeout()">â±ï¸ æµ‹è¯•è¶…æ—¶å¤„ç†</button>
                <button class="btn-danger" onclick="clearResults()">ğŸ—‘ï¸ æ¸…ç©ºç»“æœ</button>
            </div>

            <div id="planResults" class="result-section"></div>
        </div>

        <!-- AIèŠå¤©æµ‹è¯• -->
        <div class="test-section">
            <h3>ğŸ’¬ AIèŠå¤©å†…å®¹æµ‹è¯•</h3>
            <p>æµ‹è¯•AIèŠå¤©æ˜¯å¦èƒ½æ­£ç¡®æ˜¾ç¤ºçœŸå®é¢˜ç›®è€Œä¸æ˜¯"ç¤ºä¾‹é¢˜ç›®1"</p>
            
            <div class="button-group">
                <button class="btn-primary" onclick="testAiChat()">ğŸ¤– æµ‹è¯•AIèŠå¤©åŠŸèƒ½</button>
                <button class="btn-primary" onclick="testChatWithRealProblem()">ğŸ“š æµ‹è¯•çœŸé¢˜èŠå¤©</button>
            </div>
            
            <div id="chatResults" class="result-section"></div>
        </div>

        <!-- æ€§èƒ½æµ‹è¯• -->
        <div class="test-section">
            <h3>âš¡ æ€§èƒ½æµ‹è¯•</h3>
            <p>æµ‹è¯•ä¿®å¤åçš„å“åº”é€Ÿåº¦æ”¹å–„</p>
            
            <div class="button-group">
                <button class="btn-primary" onclick="performanceTest()">ğŸƒâ€â™‚ï¸ æ‰§è¡Œæ€§èƒ½æµ‹è¯•</button>
                <button class="btn-primary" onclick="batchTest()">ğŸ“Š æ‰¹é‡æµ‹è¯•(10æ¬¡)</button>
            </div>
            
            <div id="performanceResults" class="result-section"></div>
        </div>
    </div>

    <script>
        const serverHost = 'http://localhost:3000';
        let testResults = [];

        function setStatus(type, message, containerId = 'planResults') {
            const container = document.getElementById(containerId);
            container.innerHTML = `<div class="status ${type}">${message}</div>`;
        }

        function displayResult(result, containerId = 'planResults') {
            const container = document.getElementById(containerId);
            container.innerHTML += `<div class="json-display">${JSON.stringify(result, null, 2)}</div>`;
        }

        function loadExample(type) {
            const examples = {
                math: `3+5=?
8-4=?
6Ã—2=?
12Ã·3=?`,
                mixed: `15+8=?
å°æ˜æœ‰24ä¸ªè‹¹æœï¼Œå¹³å‡åˆ†ç»™6ä¸ªæœ‹å‹ï¼Œæ¯ä¸ªæœ‹å‹åˆ†åˆ°å‡ ä¸ªï¼Ÿ
35-17=?
å°çº¢ä¹°äº†3æ”¯ç¬”ï¼Œæ¯æ”¯2å…ƒï¼Œä¸€å…±èŠ±äº†å¤šå°‘é’±ï¼Ÿ`,
                chinese: `ç»™ä¸‹é¢çš„å¥å­åŠ ä¸Šæ ‡ç‚¹ç¬¦å·
æ˜¥å¤©æ¥äº†èŠ±æœµå¼€æ”¾äº†
é€‰æ‹©æ­£ç¡®çš„å­—å¡«ç©ºï¼šä»–ï¼ˆçš„ã€å¾—ã€åœ°ï¼‰è·‘å¾—å¾ˆå¿«
ä»¿å†™å¥å­ï¼šå°é¸Ÿåœ¨å¤©ç©ºä¸­é£ç¿”`,
                english: `What color is the apple?
I ___ a student. (am/is/are)
Translate: è¿™æ˜¯ä¸€æœ¬ä¹¦
Write the plural form: cat - ___`
            };
            
            document.getElementById('questions').value = examples[type] || examples.math;
            
            if (type === 'chinese') {
                document.getElementById('subject').value = 'chinese';
            } else if (type === 'english') {
                document.getElementById('subject').value = 'english';
            } else {
                document.getElementById('subject').value = 'math';
            }
        }

        async function testPlanGeneration() {
            const subject = document.getElementById('subject').value;
            const grade = document.getElementById('grade').value;
            const questionsText = document.getElementById('questions').value.trim();
            
            if (!questionsText) {
                setStatus('error', 'è¯·å…ˆè¾“å…¥é¢˜ç›®å†…å®¹');
                return;
            }

            const questions = questionsText.split('\n').filter(q => q.trim());
            
            setStatus('loading', `æ­£åœ¨æµ‹è¯•å­¦ä¹ è®¡åˆ’ç”Ÿæˆ... (${questions.length}é“é¢˜)`);
            
            const startTime = Date.now();
            
            try {
                console.log('ğŸ§ª å‘é€å­¦ä¹ è®¡åˆ’ç”Ÿæˆè¯·æ±‚:', { subject, grade, questions });
                
                const response = await fetch(`${serverHost}/api/plan/create`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        ocrText: questions,
                        subject: subject,
                        grade: parseInt(grade)
                    })
                });

                const endTime = Date.now();
                const responseTime = endTime - startTime;

                if (response.ok) {
                    const result = await response.json();
                    console.log('âœ… å­¦ä¹ è®¡åˆ’ç”ŸæˆæˆåŠŸ:', result);
                    
                    // æ£€æŸ¥æ˜¯å¦ä½¿ç”¨äº†çœŸå®é¢˜ç›®
                    const hasRealQuestions = result.questions && result.questions.some(q => 
                        questions.some(originalQ => q.text.includes(originalQ.split('=')[0]) || q.text === originalQ)
                    );
                    
                    const planSummary = `
âœ… å­¦ä¹ è®¡åˆ’ç”ŸæˆæˆåŠŸï¼
ğŸ“Š å“åº”æ—¶é—´: ${responseTime}ms
ğŸ“š è®¡åˆ’ID: ${result.planId}
ğŸ¯ å­¦ç§‘: ${subject} (${grade}å¹´çº§)
ğŸ“ é¢˜ç›®æ•°é‡: ${result.questionCount}
â±ï¸ é¢„è®¡æ€»æ—¶é•¿: ${result.estimatedTotalTime}åˆ†é’Ÿ
ğŸ” ä½¿ç”¨çœŸå®é¢˜ç›®: ${hasRealQuestions ? 'âœ… æ˜¯' : 'âŒ å¦ï¼ˆè¿˜åœ¨ä½¿ç”¨ç¤ºä¾‹æ•°æ®ï¼‰'}
ğŸ¤– AIç”Ÿæˆ: ${result.aiGenerated ? 'âœ… æ˜¯' : 'âŒ å¦'}
                    `;
                    
                    setStatus('success', planSummary);
                    displayResult(result);
                    
                    testResults.push({
                        type: 'plan_generation',
                        success: true,
                        responseTime,
                        hasRealQuestions,
                        questionCount: result.questionCount
                    });
                    
                } else {
                    const errorText = await response.text();
                    setStatus('error', `âŒ å­¦ä¹ è®¡åˆ’ç”Ÿæˆå¤±è´¥: ${response.status} - ${errorText}`);
                    
                    testResults.push({
                        type: 'plan_generation',
                        success: false,
                        error: `${response.status} - ${errorText}`
                    });
                }

            } catch (error) {
                console.error('âŒ å­¦ä¹ è®¡åˆ’ç”Ÿæˆå¤±è´¥:', error);
                setStatus('error', `âŒ å­¦ä¹ è®¡åˆ’ç”Ÿæˆå¤±è´¥: ${error.message}`);
                
                testResults.push({
                    type: 'plan_generation',
                    success: false,
                    error: error.message
                });
            }
        }

        async function testAiChat() {
            setStatus('loading', 'æ­£åœ¨æµ‹è¯•AIèŠå¤©åŠŸèƒ½...', 'chatResults');
            
            try {
                const response = await fetch(`${serverHost}/api/ai-chat/chat`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        message: 'è¿™é“é¢˜æˆ‘ä¸ä¼šåšï¼Œä½ èƒ½å¸®æˆ‘å—ï¼Ÿ',
                        questionId: 'test_q1',
                        studentId: 'test_student'
                    })
                });
                
                if (response.ok) {
                    const result = await response.json();
                    setStatus('success', 'âœ… AIèŠå¤©åŠŸèƒ½æ­£å¸¸', 'chatResults');
                    displayResult(result, 'chatResults');
                } else {
                    setStatus('error', `âŒ AIèŠå¤©å¤±è´¥: ${response.status}`, 'chatResults');
                }
                
            } catch (error) {
                setStatus('error', `âŒ AIèŠå¤©å¤±è´¥: ${error.message}`, 'chatResults');
            }
        }

        async function testChatWithRealProblem() {
            setStatus('loading', 'æ­£åœ¨æµ‹è¯•çœŸé¢˜AIèŠå¤©...', 'chatResults');
            
            try {
                const response = await fetch(`${serverHost}/api/ai-chat/chat`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        message: 'å°æ˜æœ‰24ä¸ªè‹¹æœï¼Œè¦å¹³å‡åˆ†ç»™6ä¸ªæœ‹å‹ï¼Œæ¯ä¸ªæœ‹å‹åˆ†åˆ°å‡ ä¸ªï¼Ÿè¿™é“é¢˜æˆ‘ä¸ä¼šåšã€‚',
                        questionId: 'real_math_q1',
                        studentId: 'test_student'
                    })
                });
                
                if (response.ok) {
                    const result = await response.json();
                    
                    // æ£€æŸ¥AIå›å¤æ˜¯å¦æ¶‰åŠçœŸå®é¢˜ç›®è€Œä¸æ˜¯ç¤ºä¾‹é¢˜ç›®
                    const isRealProblemResponse = result.aiResponse && (
                        result.aiResponse.includes('24') || 
                        result.aiResponse.includes('è‹¹æœ') || 
                        result.aiResponse.includes('å¹³å‡åˆ†') ||
                        result.aiResponse.includes('6ä¸ªæœ‹å‹')
                    );
                    
                    const hasTemplateResponse = result.aiResponse && (
                        result.aiResponse.includes('ç¤ºä¾‹é¢˜ç›®') ||
                        result.aiResponse.includes('æ³¨æ„çœ‹é¢˜ç›®çš„å…³é”®ä¿¡æ¯')
                    );
                    
                    const summary = `
âœ… AIèŠå¤©æµ‹è¯•å®Œæˆ
ğŸ” å›å¤å†…å®¹æ¶‰åŠçœŸå®é¢˜ç›®: ${isRealProblemResponse ? 'âœ… æ˜¯' : 'âŒ å¦'}
âš ï¸ ä½¿ç”¨æ¨¡æ¿å›å¤: ${hasTemplateResponse ? 'âŒ æ˜¯' : 'âœ… å¦'}
âš¡ å“åº”æ—¶é—´: ${result.responseTime || 'N/A'}ms
ğŸ¤– æ¨¡å‹: ${result.model || 'N/A'}
                    `;
                    
                    setStatus('success', summary, 'chatResults');
                    displayResult(result, 'chatResults');
                } else {
                    setStatus('error', `âŒ çœŸé¢˜èŠå¤©å¤±è´¥: ${response.status}`, 'chatResults');
                }
                
            } catch (error) {
                setStatus('error', `âŒ çœŸé¢˜èŠå¤©å¤±è´¥: ${error.message}`, 'chatResults');
            }
        }

        async function testTimeout() {
            setStatus('loading', 'æ­£åœ¨æµ‹è¯•è¶…æ—¶å¤„ç†ï¼ˆå¯èƒ½éœ€è¦ç­‰å¾…ï¼‰...');
            
            // åˆ›å»ºä¸€ä¸ªåŒ…å«å¤æ‚å†…å®¹çš„è¯·æ±‚æ¥è§¦å‘å¯èƒ½çš„è¶…æ—¶
            const complexQuestions = [
                'è§£æ–¹ç¨‹ï¼š2x + 5 = 15ï¼Œæ±‚xçš„å€¼ï¼Œå¹¶æ£€éªŒç­”æ¡ˆ',
                'å°æ˜çš„å¦ˆå¦ˆä¹°äº†è‹¥å¹²ä¸ªè‹¹æœï¼Œç¬¬ä¸€å¤©åƒäº†æ€»æ•°çš„1/4ï¼Œç¬¬äºŒå¤©åƒäº†å‰©ä¸‹çš„1/3ï¼Œç¬¬ä¸‰å¤©åƒäº†å‰©ä¸‹çš„1/2ï¼Œæœ€åè¿˜å‰©ä¸‹6ä¸ªè‹¹æœã€‚é—®ï¼šå°æ˜çš„å¦ˆå¦ˆæ€»å…±ä¹°äº†å¤šå°‘ä¸ªè‹¹æœï¼Ÿ',
                'ä¸€ä¸ªé•¿æ–¹å½¢çš„é•¿æ˜¯å®½çš„3å€ï¼Œå¦‚æœé•¿å‡å°‘4å˜ç±³ï¼Œå®½å¢åŠ 2å˜ç±³ï¼Œå°±å˜æˆäº†ä¸€ä¸ªæ­£æ–¹å½¢ã€‚æ±‚åŸæ¥é•¿æ–¹å½¢çš„é•¿å’Œå®½ã€‚',
                'æœ‰ä¸€å †ç³–æœï¼Œå¦‚æœæŒ‰æ¯äºº3ä¸ªåˆ†ç»™å°æœ‹å‹ï¼Œåˆ™å¤šå‡º2ä¸ªï¼›å¦‚æœæŒ‰æ¯äºº4ä¸ªåˆ†ï¼Œåˆ™å°‘3ä¸ªã€‚é—®æœ‰å¤šå°‘ä¸ªå°æœ‹å‹ï¼Œå¤šå°‘ä¸ªç³–æœï¼Ÿ'
            ];
            
            const startTime = Date.now();
            
            try {
                const response = await fetch(`${serverHost}/api/plan/create`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        ocrText: complexQuestions,
                        subject: 'math',
                        grade: 5
                    })
                });
                
                const endTime = Date.now();
                const responseTime = endTime - startTime;
                
                if (response.ok) {
                    const result = await response.json();
                    setStatus('success', `âœ… å¤æ‚é¢˜ç›®å¤„ç†æˆåŠŸ (${responseTime}ms) - æœªå‘ç”Ÿè¶…æ—¶`);
                    displayResult({ responseTime, questionCount: result.questionCount, success: true });
                } else {
                    setStatus('error', `âŒ å¤æ‚é¢˜ç›®å¤„ç†å¤±è´¥: ${response.status}`);
                }
                
            } catch (error) {
                const endTime = Date.now();
                const responseTime = endTime - startTime;
                
                if (error.name === 'AbortError' || error.message.includes('timeout')) {
                    setStatus('success', `âœ… è¶…æ—¶å¤„ç†æ­£å¸¸ (${responseTime}ms) - ç³»ç»Ÿåº”è¯¥ä½¿ç”¨fallback`);
                } else {
                    setStatus('error', `âŒ æµ‹è¯•å¤±è´¥: ${error.message}`);
                }
            }
        }

        async function performanceTest() {
            setStatus('loading', 'æ­£åœ¨è¿›è¡Œæ€§èƒ½æµ‹è¯•...', 'performanceResults');
            
            const testCases = [
                { name: 'ç®€å•è®¡ç®—é¢˜', questions: ['3+5=?', '8-4=?'], expectedTime: 5000 },
                { name: 'ä¸­ç­‰åº”ç”¨é¢˜', questions: ['å°æ˜æœ‰15ä¸ªè‹¹æœï¼Œåƒäº†3ä¸ªï¼Œè¿˜å‰©å‡ ä¸ªï¼Ÿ'], expectedTime: 8000 },
                { name: 'æ··åˆé¢˜ç›®', questions: ['6Ã—2=?', 'å°çº¢ä¹°äº†3æ”¯ç¬”ï¼Œæ¯æ”¯2å…ƒï¼Œä¸€å…±èŠ±äº†å¤šå°‘é’±ï¼Ÿ', '24Ã·6=?'], expectedTime: 10000 }
            ];
            
            let results = [];
            
            for (const testCase of testCases) {
                const startTime = Date.now();
                
                try {
                    const response = await fetch(`${serverHost}/api/plan/create`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            ocrText: testCase.questions,
                            subject: 'math',
                            grade: 3
                        })
                    });
                    
                    const endTime = Date.now();
                    const responseTime = endTime - startTime;
                    
                    results.push({
                        name: testCase.name,
                        responseTime,
                        expectedTime: testCase.expectedTime,
                        success: response.ok,
                        improved: responseTime < testCase.expectedTime
                    });
                    
                } catch (error) {
                    results.push({
                        name: testCase.name,
                        error: error.message,
                        success: false
                    });
                }
            }
            
            const summary = `
âš¡ æ€§èƒ½æµ‹è¯•å®Œæˆ
ğŸ“Š æµ‹è¯•ç”¨ä¾‹: ${results.length}ä¸ª
âœ… æˆåŠŸ: ${results.filter(r => r.success).length}ä¸ª
âŒ å¤±è´¥: ${results.filter(r => !r.success).length}ä¸ª
ğŸš€ æ€§èƒ½æ”¹å–„: ${results.filter(r => r.improved).length}ä¸ª
            `;
            
            setStatus('success', summary, 'performanceResults');
            displayResult(results, 'performanceResults');
        }

        async function batchTest() {
            setStatus('loading', 'æ­£åœ¨è¿›è¡Œæ‰¹é‡æµ‹è¯•ï¼ˆ10æ¬¡ï¼‰...', 'performanceResults');
            
            const questions = ['3+5=?', '8-4=?', 'å°æ˜æœ‰15ä¸ªè‹¹æœï¼Œåƒäº†3ä¸ªï¼Œè¿˜å‰©å‡ ä¸ªï¼Ÿ'];
            let results = [];
            
            for (let i = 0; i < 10; i++) {
                const startTime = Date.now();
                
                try {
                    const response = await fetch(`${serverHost}/api/plan/create`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            ocrText: questions,
                            subject: 'math',
                            grade: 3
                        })
                    });
                    
                    const endTime = Date.now();
                    const responseTime = endTime - startTime;
                    
                    results.push({
                        testNum: i + 1,
                        responseTime,
                        success: response.ok
                    });
                    
                } catch (error) {
                    results.push({
                        testNum: i + 1,
                        error: error.message,
                        success: false
                    });
                }
                
                // çŸ­æš‚å»¶è¿Ÿé¿å…è¿‡äºå¯†é›†çš„è¯·æ±‚
                await new Promise(resolve => setTimeout(resolve, 100));
            }
            
            const successfulResults = results.filter(r => r.success && r.responseTime);
            const avgResponseTime = successfulResults.length > 0 ? 
                successfulResults.reduce((sum, r) => sum + r.responseTime, 0) / successfulResults.length : 0;
            
            const summary = `
ğŸ“Š æ‰¹é‡æµ‹è¯•å®Œæˆ (10æ¬¡)
âœ… æˆåŠŸç‡: ${results.filter(r => r.success).length}/10
âš¡ å¹³å‡å“åº”æ—¶é—´: ${Math.round(avgResponseTime)}ms
ğŸ”¥ æœ€å¿«å“åº”: ${Math.min(...successfulResults.map(r => r.responseTime))}ms
ğŸŒ æœ€æ…¢å“åº”: ${Math.max(...successfulResults.map(r => r.responseTime))}ms
            `;
            
            setStatus('success', summary, 'performanceResults');
            displayResult(results, 'performanceResults');
        }

        function clearResults() {
            document.getElementById('planResults').innerHTML = '';
            document.getElementById('chatResults').innerHTML = '';
            document.getElementById('performanceResults').innerHTML = '';
            testResults = [];
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨åŠ è½½ç¤ºä¾‹
        window.onload = function() {
            loadExample('math');
        };
    </script>
</body>
</html> 