import{_ as v,c as i,a as t,d as g,t as r,F as u,r as h,n as f,i as j,b as S,o as n}from"./index-Dk_8qRP-.js";const k={name:"Subjects",data(){return{loading:!1,error:null,subjects:[],stats:{totalSubjects:0,totalSkills:0,totalGrades:0,totalErrors:0}}},async mounted(){await this.loadSubjects()},methods:{async loadSubjects(){this.loading=!0,this.error=null;try{console.log("🎓 开始加载科目数据...");const e="/api/ai-chat/subjects";console.log("📡 请求地址:",e);const s=await S.get(e);if(console.log("📦 API响应:",s),!s)throw new Error("API响应为空");if(!s.data)throw new Error("API响应数据为空");if(console.log("📊 响应数据结构:",{hasData:!!s.data,hasSuccess:!!s.data.success,successValue:s.data.success,hasDataData:!!s.data.data,hasSubjects:!!(s.data.data&&s.data.data.subjects),subjectsLength:s.data.data&&s.data.data.subjects?s.data.data.subjects.length:0}),s.data.success===!0)if(s.data.data&&s.data.data.subjects)this.subjects=s.data.data.subjects,console.log("✅ 使用标准格式加载科目数据:",this.subjects.length,"个科目");else throw new Error("响应数据中缺少subjects字段");else if(Array.isArray(s.data))this.subjects=s.data,console.log("✅ 使用数组格式加载科目数据:",this.subjects.length,"个科目");else if(s.data.subjects)this.subjects=s.data.subjects,console.log("✅ 使用直接格式加载科目数据:",this.subjects.length,"个科目");else throw console.error("❌ 未知的数据格式:",s.data),new Error(`科目数据格式错误: ${JSON.stringify(s.data).substring(0,200)}...`);if(!Array.isArray(this.subjects))throw new Error("科目数据不是数组格式");this.subjects.length===0&&console.warn("⚠️ 科目数据为空"),this.subjects.forEach((a,b)=>{(!a.key||!a.name)&&console.warn(`⚠️ 科目 ${b} 缺少必要字段:`,a)}),this.calculateStats(),console.log("✅ 科目数据加载和统计计算完成:",{subjectsCount:this.subjects.length,stats:this.stats})}catch(e){console.error("❌ 科目数据加载失败:",{error:e.message,stack:e.stack,response:e.response}),e.response?e.response.status===404?this.error="API接口不存在，请检查服务器状态":e.response.status===500?this.error="服务器内部错误，请稍后重试":this.error=`网络错误 (${e.response.status}): ${e.response.statusText}`:e.message.includes("科目数据格式错误")?this.error=`数据格式错误: ${e.message}`:e.message.includes("Network Error")?this.error="网络连接失败，请检查网络或服务器状态":this.error=e.message||"加载科目信息失败",this.subjects=[],this.calculateStats()}finally{this.loading=!1}},calculateStats(){if(!this.subjects||this.subjects.length===0){this.stats={totalSubjects:0,totalSkills:0,totalGrades:0,totalErrors:0};return}this.stats.totalSubjects=this.subjects.length,this.stats.totalSkills=this.subjects.reduce((s,a)=>s+(a.skillTypes?a.skillTypes.length:0),0);const e=new Set;this.subjects.forEach(s=>{s.grades&&s.grades.forEach(a=>e.add(a))}),this.stats.totalGrades=e.size,this.stats.totalErrors=this.subjects.reduce((s,a)=>s+(a.commonErrors?a.commonErrors.length:0),0),console.log("📊 统计数据计算完成:",this.stats)},getSubjectsForGrade(e){return this.subjects.filter(s=>s.grades&&s.grades.includes(e))},getSubjectColor(e){return{math:"#FF6B6B",chinese:"#4ECDC4",english:"#45B7D1",science:"#96CEB4"}[e]||"#9B59B6"},scrollToSubjects(){var e;(e=this.$refs.subjectsSection)==null||e.scrollIntoView({behavior:"smooth",block:"start"})},scrollToSkills(){var e,s;(s=(e=this.$refs.skillsSection)==null?void 0:e[0])==null||s.scrollIntoView({behavior:"smooth",block:"start"})},scrollToGrades(){var e;(e=this.$refs.gradesSection)==null||e.scrollIntoView({behavior:"smooth",block:"start"})},scrollToErrors(){var e,s;(s=(e=this.$refs.errorsSection)==null?void 0:e[0])==null||s.scrollIntoView({behavior:"smooth",block:"start"})},viewSubjectDetail(e){console.log("查看科目详情:",e.name)}}},m={class:"subjects-management"},p={class:"stats-cards"},y={class:"stat-info"},_={class:"stat-info"},w={class:"stat-info"},E={class:"stat-info"},C={class:"subjects-list",ref:"subjectsSection"},T={class:"subject-grid"},G=["onClick"],B={class:"subject-header"},I={class:"subject-icon"},A={class:"subject-description"},D={class:"subject-stats"},F={class:"stat-item"},V={class:"stat-value"},x={class:"stat-item"},N={class:"stat-value"},P={class:"stat-item"},z={class:"stat-value"},L={class:"skill-tags"},J={class:"error-tags"},O={class:"grade-distribution",ref:"gradesSection"},U={class:"grade-chart"},q={class:"grade-label"},H={class:"grade-subjects"},K={class:"grade-count"},M={key:0,class:"loading"},Q={key:1,class:"error-message"};function R(e,s,a,b,d,o){return n(),i("div",m,[s[21]||(s[21]=t("div",{class:"page-header"},[t("h1",null,"🎓 科目管理"),t("p",null,"管理语文、数学、英语、科学四门核心科目")],-1)),t("div",p,[t("div",{class:"stat-card",onClick:s[0]||(s[0]=(...l)=>o.scrollToSubjects&&o.scrollToSubjects(...l))},[s[6]||(s[6]=t("div",{class:"stat-icon"},"📚",-1)),t("div",y,[t("h3",null,r(d.stats.totalSubjects),1),s[5]||(s[5]=t("p",null,"科目总数",-1))])]),t("div",{class:"stat-card",onClick:s[1]||(s[1]=(...l)=>o.scrollToSkills&&o.scrollToSkills(...l))},[s[8]||(s[8]=t("div",{class:"stat-icon"},"🎯",-1)),t("div",_,[t("h3",null,r(d.stats.totalSkills),1),s[7]||(s[7]=t("p",null,"技能类型",-1))])]),t("div",{class:"stat-card",onClick:s[2]||(s[2]=(...l)=>o.scrollToGrades&&o.scrollToGrades(...l))},[s[10]||(s[10]=t("div",{class:"stat-icon"},"📈",-1)),t("div",w,[t("h3",null,r(d.stats.totalGrades),1),s[9]||(s[9]=t("p",null,"年级覆盖",-1))])]),t("div",{class:"stat-card",onClick:s[3]||(s[3]=(...l)=>o.scrollToErrors&&o.scrollToErrors(...l))},[s[12]||(s[12]=t("div",{class:"stat-icon"},"⚠️",-1)),t("div",E,[t("h3",null,r(d.stats.totalErrors),1),s[11]||(s[11]=t("p",null,"常见错误",-1))])])]),t("div",C,[s[18]||(s[18]=t("h2",null,"📋 科目详情",-1)),t("div",T,[(n(!0),i(u,null,h(d.subjects,l=>(n(),i("div",{key:l.key,class:"subject-card",onClick:c=>o.viewSubjectDetail(l)},[t("div",B,[t("span",I,r(l.icon),1),t("h3",null,r(l.name),1),t("span",{class:f(["subject-status",{active:l.isSupported}])},r(l.isSupported?"已启用":"未启用"),3)]),t("div",A,r(l.description),1),t("div",D,[t("div",F,[s[13]||(s[13]=t("span",{class:"stat-label"},"年级范围:",-1)),t("span",V,r(l.grades.join("、"))+"年级",1)]),t("div",x,[s[14]||(s[14]=t("span",{class:"stat-label"},"技能类型:",-1)),t("span",N,r(l.skillCount)+"种",1)]),t("div",P,[s[15]||(s[15]=t("span",{class:"stat-label"},"常见错误:",-1)),t("span",z,r(l.errorTypes)+"类",1)])]),t("div",{class:"subject-skills",ref_for:!0,ref:"skillsSection"},[s[16]||(s[16]=t("h4",null,"🎯 技能类型",-1)),t("div",L,[(n(!0),i(u,null,h(l.skillTypes,c=>(n(),i("span",{key:c,class:"skill-tag"},r(c),1))),128))])],512),t("div",{class:"subject-errors",ref_for:!0,ref:"errorsSection"},[s[17]||(s[17]=t("h4",null,"⚠️ 常见错误",-1)),t("div",J,[(n(!0),i(u,null,h(l.commonErrors,c=>(n(),i("span",{key:c,class:"error-tag"},r(c),1))),128))])],512)],8,G))),128))])],512),t("div",O,[s[19]||(s[19]=t("h2",null,"📊 年级分布",-1)),t("div",U,[(n(),i(u,null,h([1,2,3,4,5,6],l=>t("div",{key:l,class:"grade-bar"},[t("div",q,r(l)+"年级",1),t("div",H,[(n(!0),i(u,null,h(o.getSubjectsForGrade(l),c=>(n(),i("span",{key:c.key,class:"grade-subject",style:j({backgroundColor:o.getSubjectColor(c.key)})},r(c.icon)+" "+r(c.name),5))),128))]),t("div",K,r(o.getSubjectsForGrade(l).length)+"门",1)])),64))])],512),d.loading?(n(),i("div",M,s[20]||(s[20]=[t("div",{class:"spinner"},null,-1),t("p",null,"正在加载科目信息...",-1)]))):g("",!0),d.error?(n(),i("div",Q,[t("p",null,"❌ "+r(d.error),1),t("button",{onClick:s[4]||(s[4]=(...l)=>o.loadSubjects&&o.loadSubjects(...l)),class:"retry-btn"},"重试")])):g("",!0)])}const X=v(k,[["render",R],["__scopeId","data-v-576a16fd"]]);export{X as default};
