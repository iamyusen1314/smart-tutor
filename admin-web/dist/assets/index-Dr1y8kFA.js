import{_ as f,c as n,a as e,d as M,t as o,F as h,r as v,w as u,e as c,v as m,b as d,o as r}from"./index-Dk_8qRP-.js";const w={name:"Materials",data(){return{loading:!1,uploading:!1,materials:[],stats:{total:0,totalSize:"0 MB"},showUploadModal:!1,newMaterial:{name:"",description:"",file:null}}},mounted(){this.loadData()},methods:{async loadData(){this.loading=!0;try{await Promise.all([this.loadMaterials(),this.loadStats()])}catch(a){console.error("Âä†ËΩΩÊï∞ÊçÆÂ§±Ë¥•:",a)}finally{this.loading=!1}},async loadMaterials(){try{const a=await d.materials.search({});this.materials=a.data||[]}catch(a){console.error("Âä†ËΩΩÊïôÊùêÂàóË°®Â§±Ë¥•:",a),this.materials=[]}},async loadStats(){try{const a=await d.materials.getStats();this.stats=a||{}}catch(a){console.error("Âä†ËΩΩÁªüËÆ°Êï∞ÊçÆÂ§±Ë¥•:",a)}},handleFileSelect(a){const t=a.target.files[0];t&&(this.newMaterial.file=t,this.newMaterial.name||(this.newMaterial.name=t.name))},async uploadMaterial(){if(!this.newMaterial.file){alert("ËØ∑ÈÄâÊã©Êñá‰ª∂");return}this.uploading=!0;try{const a=new FormData;a.append("file",this.newMaterial.file),a.append("name",this.newMaterial.name),a.append("description",this.newMaterial.description),await d.materials.upload(a),alert("ÊïôÊùê‰∏ä‰º†ÊàêÂäüÔºÅ"),this.showUploadModal=!1,this.newMaterial={name:"",description:"",file:null},await this.loadData()}catch(a){alert("‰∏ä‰º†ÊïôÊùêÂ§±Ë¥•Ôºö"+a.message)}finally{this.uploading=!1}},async deleteMaterial(a){if(confirm("Á°ÆÂÆöË¶ÅÂà†Èô§Ëøô‰∏™ÊïôÊùêÂêóÔºü"))try{alert("Âà†Èô§ÂäüËÉΩÂæÖÂÆûÁé∞")}catch(t){alert("Âà†Èô§ÊïôÊùêÂ§±Ë¥•Ôºö"+t.message)}},viewMaterial(a){alert("Êü•ÁúãÂäüËÉΩÂæÖÂÆûÁé∞Ôºö"+a.name)},async testMaterialAPI(){try{const a=await d.materials.getStats();alert("ÊïôÊùêAPIÊµãËØïÊàêÂäüÔºÅ"),console.log("APIÊµãËØïÁªìÊûú:",a)}catch(a){alert("ÊïôÊùêAPIÊµãËØïÂ§±Ë¥•ÔºÅ"),console.error("APIÊµãËØïÂ§±Ë¥•:",a)}},formatDate(a){return a?new Date(a).toLocaleDateString("zh-CN"):"Êú™Áü•"}}},y={class:"materials"},b={class:"toolbar"},g={class:"stats-summary"},_={class:"stat-item"},k={class:"stat-value"},C={class:"stat-item"},D={class:"stat-value"},S={class:"material-list"},x={key:0,class:"loading"},A={key:1,class:"empty"},I={key:2},P={class:"material-info"},U={class:"material-meta"},F={class:"material-actions"},B=["onClick"],z=["onClick"],V={class:"form-group"},N={class:"form-group"},q={class:"form-group"},L={class:"form-actions"},E=["disabled"];function T(a,t,j,G,l,i){return r(),n("div",y,[t[15]||(t[15]=e("h2",null,"üìñ ÊïôÊùêÁÆ°ÁêÜ",-1)),e("div",b,[e("button",{class:"btn-primary",onClick:t[0]||(t[0]=s=>l.showUploadModal=!0)}," üìÅ ‰∏ä‰º†ÊïôÊùê "),e("button",{class:"btn-secondary",onClick:t[1]||(t[1]=(...s)=>i.testMaterialAPI&&i.testMaterialAPI(...s))}," üîß ÊµãËØïAPI ")]),e("div",g,[e("div",_,[t[9]||(t[9]=e("span",{class:"stat-label"},"ÊïôÊùêÊÄªÊï∞:",-1)),e("span",k,o(l.stats.total||0),1)]),e("div",C,[t[10]||(t[10]=e("span",{class:"stat-label"},"Â≠òÂÇ®Â§ßÂ∞è:",-1)),e("span",D,o(l.stats.totalSize||"0 MB"),1)])]),e("div",S,[l.loading?(r(),n("div",x,"Âä†ËΩΩ‰∏≠...")):l.materials.length===0?(r(),n("div",A," ÊöÇÊó†ÊïôÊùêÊï∞ÊçÆ ")):(r(),n("div",I,[(r(!0),n(h,null,v(l.materials,s=>(r(),n("div",{key:s._id,class:"material-item"},[e("div",P,[e("h4",null,o(s.name||"ÊïôÊùêÂêçÁß∞"),1),e("p",null,o(s.description||"ÊïôÊùêÊèèËø∞"),1),e("span",U," Â§ßÂ∞è: "+o(s.size||"Êú™Áü•")+" | Á±ªÂûã: "+o(s.type||"Êú™Áü•")+" | ‰∏ä‰º†Êó∂Èó¥: "+o(i.formatDate(s.createdAt)),1)]),e("div",F,[e("button",{onClick:p=>i.viewMaterial(s),class:"btn-view"},"Êü•Áúã",8,B),e("button",{onClick:p=>i.deleteMaterial(s._id),class:"btn-delete"},"Âà†Èô§",8,z)])]))),128))]))]),l.showUploadModal?(r(),n("div",{key:0,class:"modal-overlay",onClick:t[8]||(t[8]=s=>l.showUploadModal=!1)},[e("div",{class:"modal",onClick:t[7]||(t[7]=u(()=>{},["stop"]))},[t[14]||(t[14]=e("h3",null,"‰∏ä‰º†ÊïôÊùê",-1)),e("form",{onSubmit:t[6]||(t[6]=u((...s)=>i.uploadMaterial&&i.uploadMaterial(...s),["prevent"]))},[e("div",V,[t[11]||(t[11]=e("label",null,"ÊïôÊùêÂêçÁß∞:",-1)),c(e("input",{"onUpdate:modelValue":t[2]||(t[2]=s=>l.newMaterial.name=s),type:"text",required:""},null,512),[[m,l.newMaterial.name]])]),e("div",N,[t[12]||(t[12]=e("label",null,"ÊïôÊùêÊèèËø∞:",-1)),c(e("textarea",{"onUpdate:modelValue":t[3]||(t[3]=s=>l.newMaterial.description=s)},null,512),[[m,l.newMaterial.description]])]),e("div",q,[t[13]||(t[13]=e("label",null,"ÈÄâÊã©Êñá‰ª∂:",-1)),e("input",{type:"file",onChange:t[4]||(t[4]=(...s)=>i.handleFileSelect&&i.handleFileSelect(...s)),accept:".pdf,.doc,.docx,.txt",required:""},null,32)]),e("div",L,[e("button",{type:"button",onClick:t[5]||(t[5]=s=>l.showUploadModal=!1)},"ÂèñÊ∂à"),e("button",{type:"submit",class:"btn-primary",disabled:l.uploading},o(l.uploading?"‰∏ä‰º†‰∏≠...":"‰∏ä‰º†"),9,E)])],32)])])):M("",!0)])}const J=f(w,[["render",T],["__scopeId","data-v-5a465510"]]);export{J as default};
