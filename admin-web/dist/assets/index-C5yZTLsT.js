import{_ as k,c as o,a as e,d as u,f as p,t as i,e as m,g as f,h as S,v as A,F as y,r as h,n as I,b as c,o as l}from"./index-Dk_8qRP-.js";const P={name:"Questions",data(){return{loading:!1,error:null,questions:[],currentPage:1,totalPages:1,pageSize:10,aiStats:{totalGenerated:0,activeStudents:0,avgAccuracy:0,todayGenerated:0},filters:{subject:"",grade:"",difficulty:"",dateFrom:"",dateTo:""},aiInsights:[]}},async mounted(){var a,t,d;console.log("🔍 检查API服务:",{api:!!c,questions:!!((a=c)!=null&&a.questions),getList:!!((d=(t=c)==null?void 0:t.questions)!=null&&d.getList)}),await this.loadQuestions(),await this.loadAIStats(),await this.loadAIInsights()},methods:{async loadQuestions(){var a,t;this.loading=!0,this.error=null;try{if(console.log("📚 加载AI生成题目记录..."),!c||!c.questions||!c.questions.getList)throw new Error("API服务未正确初始化");const d={page:this.currentPage,limit:this.pageSize,isAIGenerated:!0,...this.filters},g=await c.questions.getList(d);if(g&&g.success)this.questions=((a=g.data)==null?void 0:a.questions)||g.data||[],this.totalPages=Math.ceil((((t=g.data)==null?void 0:t.total)||g.total||0)/this.pageSize),console.log("✅ AI题目记录加载成功:",this.questions.length);else throw new Error((g==null?void 0:g.message)||"获取题目记录失败")}catch(d){console.error("❌ 加载AI题目记录失败:",d),this.error=d.message,(d.message.includes("API")||d.message.includes("网络")||d.message.includes("初始化"))&&(console.log("🎭 加载模拟数据作为备选方案"),this.loadMockData())}finally{this.loading=!1}},async loadAIStats(){try{if(c&&c.analytics&&c.analytics.getAIGenerationStats){const a=await c.analytics.getAIGenerationStats();a&&a.success&&(this.aiStats=a.data)}}catch(a){console.warn("获取AI统计失败:",a),this.aiStats={totalGenerated:1247,activeStudents:89,avgAccuracy:76,todayGenerated:23}}},async loadAIInsights(){try{if(c&&c.analytics&&c.analytics.getAIInsights){const a=await c.analytics.getAIInsights({limit:5,type:"question_generation"});a&&a.success&&(this.aiInsights=a.data||[])}}catch(a){console.warn("获取AI洞察失败:",a),this.aiInsights=[{id:1,type:"题目难度分析",content:"发现学生在分数计算方面正确率较低(62%)，AI已自动调整生成更多基础练习题",timestamp:new Date().toISOString()},{id:2,type:"学习模式识别",content:"检测到视觉学习型学生增多，AI正在生成更多图形化数学题",timestamp:new Date(Date.now()-36e5).toISOString()}]}},loadMockData(){console.log("🎭 加载模拟AI生成题目数据"),this.questions=[{id:1,content:"小明有24个苹果，平均分给6个朋友，每个朋友分到几个苹果？",subject:"math",grade:3,difficulty:"easy",type:"calculation",answer:"4个",explanation:"24÷6=4，所以每个朋友分到4个苹果",knowledgePoints:["除法运算","平均分配"],isAIGenerated:!0,generationContext:{triggerType:"OCR识别",description:"学生拍照了类似的除法应用题",weakPoints:["除法运算"]},usageStats:{attempts:5,accuracy:.8,avgTime:2.5},createdAt:new Date().toISOString()},{id:2,content:"下列哪个算式的结果是12？",options:["3×4","2×7","6+5","15-3"],subject:"math",grade:2,difficulty:"medium",type:"choice",answer:"A",explanation:"3×4=12，其他选项：B=14，C=11，D=12，所以A和D都正确，但A是最直接的答案",knowledgePoints:["乘法运算","加减法运算"],isAIGenerated:!0,generationContext:{triggerType:"薄弱点强化",description:"针对该学生的乘法运算薄弱点生成",weakPoints:["乘法运算","数学运算"]},usageStats:{attempts:8,accuracy:.75,avgTime:1.8},createdAt:new Date(Date.now()-864e5).toISOString()},{id:3,content:"一个长方形的长是8cm，宽是5cm，求这个长方形的周长。",subject:"math",grade:4,difficulty:"medium",type:"calculation",answer:"26cm",explanation:"长方形周长 = 2×(长+宽) = 2×(8+5) = 2×13 = 26cm",knowledgePoints:["长方形周长","几何计算"],isAIGenerated:!0,generationContext:{triggerType:"学习计划定制",description:"根据学生当前学习进度生成的几何题",weakPoints:["几何计算"]},usageStats:{attempts:3,accuracy:.67,avgTime:3.2},createdAt:new Date(Date.now()-1728e5).toISOString()}],this.totalPages=1},changePage(a){this.currentPage=a,this.loadQuestions()},getSubjectName(a){return{math:"数学",chinese:"语文",english:"英语"}[a]||a},getDifficultyName(a){return{easy:"简单",medium:"中等",hard:"困难"}[a]||a},formatDate(a){if(!a)return"";const t=new Date(a),g=new Date-t;return g<6e4?"刚刚":g<36e5?`${Math.floor(g/6e4)}分钟前`:g<864e5?`${Math.floor(g/36e5)}小时后`:g<6048e5?`${Math.floor(g/864e5)}天前`:t.toLocaleDateString()},viewDetails(a){console.log("查看题目详情:",a),alert(`题目详情：

${JSON.stringify(a,null,2)}`)},viewStudentProgress(a){var t,d,g;console.log("查看学生表现:",a),alert(`学生表现分析：

使用次数：${((t=a.usageStats)==null?void 0:t.attempts)||0}
正确率：${(((d=a.usageStats)==null?void 0:d.accuracy)*100||0).toFixed(1)}%
平均用时：${((g=a.usageStats)==null?void 0:g.avgTime)||0}分钟`)},async regenerateQuestion(a){var t;if(confirm("确定要让AI重新生成这道题目吗？"))try{if(console.log("🤖 请求AI重新生成题目:",a.id),!c||!c.aiGenerator||!c.aiGenerator.regenerateQuestion)throw new Error("AI生成服务不可用");const d=await c.aiGenerator.regenerateQuestion({questionId:a.id,reason:"low_accuracy",currentAccuracy:((t=a.usageStats)==null?void 0:t.accuracy)||0});if(d&&d.success)alert("✅ AI重新生成请求已提交，新题目将在下次学习中展示给学生"),this.loadQuestions();else throw new Error((d==null?void 0:d.message)||"重新生成失败")}catch(d){console.error("❌ AI重新生成失败:",d),alert(`❌ 重新生成失败: ${d.message}`)}},async refreshData(){await Promise.all([this.loadQuestions(),this.loadAIStats(),this.loadAIInsights()])},async testAPI(){try{if(console.log("🧪 测试AI生成API..."),!c||!c.aiGenerator||!c.aiGenerator.generatePractice)throw new Error("AI生成服务不可用");const a={ocrData:{analyzedContent:"3×4=?",subject:"math",grade:3,knowledgePoints:["乘法运算"]},studentProfile:{userId:"test_student",grade:3,preferredSubjects:["math"],averageAccuracy:.75},learningHistory:[],weakPoints:[{knowledgePoint:"乘法运算",errorRate:.4}]},t=await c.aiGenerator.generatePractice(a);console.log("✅ API测试成功:",t),alert(`✅ AI生成API测试成功！

`+JSON.stringify(t,null,2))}catch(a){console.error("❌ API测试失败:",a),alert(`❌ API测试失败: ${a.message}`)}}}},_={class:"questions-container"},b={class:"stats-panel"},C={class:"stat-card"},D={class:"stat-number"},x={class:"stat-card"},Q={class:"stat-number"},G={class:"stat-card"},T={class:"stat-number"},j={class:"stat-card"},N={class:"stat-number"},V={class:"filter-section"},M={class:"filter-row"},O={key:0,class:"loading"},F={key:1,class:"error-message"},E={key:2,class:"questions-list"},L={key:0,class:"empty-state"},z={key:1},U={class:"question-header"},B={class:"question-meta"},J={class:"grade-tag"},R={key:0,class:"ai-tag"},H={class:"question-time"},K={class:"question-content"},W={key:0,class:"ai-context"},X={key:0,class:"weak-points"},Y={key:1,class:"question-options"},Z={class:"option-label"},q={class:"option-text"},$={class:"answer-section"},tt={class:"answer"},et={key:0,class:"explanation"},st={key:2,class:"knowledge-points"},at={key:3,class:"usage-stats"},nt={class:"stat-item"},ot={class:"stat-value"},it={class:"stat-item"},lt={class:"stat-value"},rt={class:"stat-item"},dt={class:"stat-value"},ct={class:"question-actions"},gt=["onClick"],ut=["onClick"],vt=["onClick"],pt={key:3,class:"pagination"},mt=["disabled"],yt={class:"page-info"},ht=["disabled"],ft={key:4,class:"ai-insights-panel"},It={class:"insights-list"},wt={class:"insight-type"},At={class:"insight-content"},kt={class:"insight-time"},St={class:"debug-section"};function Pt(a,t,d,g,n,r){return l(),o("div",_,[t[35]||(t[35]=e("div",{class:"page-header"},[e("h1",null,[e("i",{class:"icon"},"🤖"),p(" AI题目生成记录 ")]),e("p",{class:"description"}," 查看AI根据学生学习行为动态生成的个性化题目记录 ")],-1)),e("div",b,[e("div",C,[e("div",D,i(n.aiStats.totalGenerated),1),t[15]||(t[15]=e("div",{class:"stat-label"},"AI生成题目总数",-1))]),e("div",x,[e("div",Q,i(n.aiStats.activeStudents),1),t[16]||(t[16]=e("div",{class:"stat-label"},"活跃学生数",-1))]),e("div",G,[e("div",T,i(n.aiStats.avgAccuracy)+"%",1),t[17]||(t[17]=e("div",{class:"stat-label"},"平均准确率",-1))]),e("div",j,[e("div",N,i(n.aiStats.todayGenerated),1),t[18]||(t[18]=e("div",{class:"stat-label"},"今日生成题目",-1))])]),e("div",V,[e("div",M,[m(e("select",{"onUpdate:modelValue":t[0]||(t[0]=s=>n.filters.subject=s),onChange:t[1]||(t[1]=(...s)=>r.loadQuestions&&r.loadQuestions(...s))},t[19]||(t[19]=[e("option",{value:""},"全部学科",-1),e("option",{value:"math"},"数学",-1),e("option",{value:"chinese"},"语文",-1),e("option",{value:"english"},"英语",-1)]),544),[[f,n.filters.subject]]),m(e("select",{"onUpdate:modelValue":t[2]||(t[2]=s=>n.filters.grade=s),onChange:t[3]||(t[3]=(...s)=>r.loadQuestions&&r.loadQuestions(...s))},t[20]||(t[20]=[S('<option value="" data-v-7509ae4c>全部年级</option><option value="1" data-v-7509ae4c>一年级</option><option value="2" data-v-7509ae4c>二年级</option><option value="3" data-v-7509ae4c>三年级</option><option value="4" data-v-7509ae4c>四年级</option><option value="5" data-v-7509ae4c>五年级</option><option value="6" data-v-7509ae4c>六年级</option>',7)]),544),[[f,n.filters.grade]]),m(e("select",{"onUpdate:modelValue":t[4]||(t[4]=s=>n.filters.difficulty=s),onChange:t[5]||(t[5]=(...s)=>r.loadQuestions&&r.loadQuestions(...s))},t[21]||(t[21]=[e("option",{value:""},"全部难度",-1),e("option",{value:"easy"},"简单",-1),e("option",{value:"medium"},"中等",-1),e("option",{value:"hard"},"困难",-1)]),544),[[f,n.filters.difficulty]]),m(e("input",{type:"date","onUpdate:modelValue":t[6]||(t[6]=s=>n.filters.dateFrom=s),onChange:t[7]||(t[7]=(...s)=>r.loadQuestions&&r.loadQuestions(...s)),placeholder:"开始日期"},null,544),[[A,n.filters.dateFrom]]),m(e("input",{type:"date","onUpdate:modelValue":t[8]||(t[8]=s=>n.filters.dateTo=s),onChange:t[9]||(t[9]=(...s)=>r.loadQuestions&&r.loadQuestions(...s)),placeholder:"结束日期"},null,544),[[A,n.filters.dateTo]]),e("button",{onClick:t[10]||(t[10]=(...s)=>r.refreshData&&r.refreshData(...s)),class:"refresh-btn"},t[22]||(t[22]=[e("i",{class:"icon"},"🔄",-1),p(" 刷新数据 ")]))])]),n.loading?(l(),o("div",O,t[23]||(t[23]=[e("i",{class:"icon"},"⏳",-1),p(" 正在加载AI生成的题目记录... ")]))):u("",!0),n.error?(l(),o("div",F,[t[24]||(t[24]=e("i",{class:"icon"},"❌",-1)),p(" "+i(n.error)+" ",1),e("button",{onClick:t[11]||(t[11]=(...s)=>r.loadQuestions&&r.loadQuestions(...s)),class:"retry-btn"},"重试")])):u("",!0),!n.loading&&!n.error?(l(),o("div",E,[n.questions.length===0?(l(),o("div",L,t[25]||(t[25]=[e("i",{class:"icon"},"🤖",-1),e("h3",null,"暂无AI生成题目",-1),e("p",null,"当学生开始使用拍照学习功能时，AI会自动生成个性化练习题",-1)]))):(l(),o("div",z,[(l(!0),o(y,null,h(n.questions,s=>(l(),o("div",{key:s._id||s.id,class:I(["question-card",{"ai-generated":s.isAIGenerated}])},[e("div",U,[e("div",B,[e("span",{class:I(["subject-tag",s.subject])},i(r.getSubjectName(s.subject)),3),e("span",J,i(s.grade)+"年级",1),e("span",{class:I(["difficulty-tag",s.difficulty])},i(r.getDifficultyName(s.difficulty)),3),s.isAIGenerated?(l(),o("span",R," 🤖 AI生成 ")):u("",!0)]),e("div",H,i(r.formatDate(s.createdAt)),1)]),e("div",K,[e("h4",null,i(s.content||s.text),1),s.generationContext?(l(),o("div",W,[t[27]||(t[27]=e("h5",null,"🎯 生成背景:",-1)),e("p",null,i(s.generationContext.triggerType)+": "+i(s.generationContext.description),1),s.generationContext.weakPoints&&s.generationContext.weakPoints.length>0?(l(),o("div",X,[t[26]||(t[26]=e("strong",null,"针对薄弱点:",-1)),(l(!0),o(y,null,h(s.generationContext.weakPoints,v=>(l(),o("span",{key:v,class:"weak-point-tag"},i(v),1))),128))])):u("",!0)])):u("",!0),s.options&&s.options.length>0?(l(),o("div",Y,[(l(!0),o(y,null,h(s.options,(v,w)=>(l(),o("div",{key:w,class:"option"},[e("span",Z,i(String.fromCharCode(65+w))+".",1),e("span",q,i(v),1)]))),128))])):u("",!0),e("div",$,[e("div",tt,[t[28]||(t[28]=e("strong",null,"答案:",-1)),p(" "+i(s.answer),1)]),s.explanation?(l(),o("div",et,[t[29]||(t[29]=e("strong",null,"解析:",-1)),p(" "+i(s.explanation),1)])):u("",!0)]),s.knowledgePoints&&s.knowledgePoints.length>0?(l(),o("div",st,[t[30]||(t[30]=e("strong",null,"知识点:",-1)),(l(!0),o(y,null,h(s.knowledgePoints,v=>(l(),o("span",{key:v,class:"knowledge-tag"},i(v),1))),128))])):u("",!0),s.usageStats?(l(),o("div",at,[e("div",nt,[t[31]||(t[31]=e("span",{class:"stat-label"},"使用次数:",-1)),e("span",ot,i(s.usageStats.attempts||0),1)]),e("div",it,[t[32]||(t[32]=e("span",{class:"stat-label"},"正确率:",-1)),e("span",lt,i((s.usageStats.accuracy*100).toFixed(1))+"%",1)]),e("div",rt,[t[33]||(t[33]=e("span",{class:"stat-label"},"平均用时:",-1)),e("span",dt,i(s.usageStats.avgTime)+"分钟",1)])])):u("",!0)]),e("div",ct,[e("button",{onClick:v=>r.viewDetails(s),class:"details-btn"}," 查看详情 ",8,gt),e("button",{onClick:v=>r.viewStudentProgress(s),class:"progress-btn"}," 学生表现 ",8,ut),s.usageStats&&s.usageStats.accuracy<.5?(l(),o("button",{key:0,onClick:v=>r.regenerateQuestion(s),class:"regenerate-btn"}," 🤖 重新生成 ",8,vt)):u("",!0)])],2))),128))]))])):u("",!0),n.totalPages>1?(l(),o("div",pt,[e("button",{disabled:n.currentPage<=1,onClick:t[12]||(t[12]=s=>r.changePage(n.currentPage-1)),class:"page-btn"}," 上一页 ",8,mt),e("span",yt," 第 "+i(n.currentPage)+" 页，共 "+i(n.totalPages)+" 页 ",1),e("button",{disabled:n.currentPage>=n.totalPages,onClick:t[13]||(t[13]=s=>r.changePage(n.currentPage+1)),class:"page-btn"}," 下一页 ",8,ht)])):u("",!0),n.aiInsights.length>0?(l(),o("div",ft,[t[34]||(t[34]=e("h3",null,"🤖 AI分析洞察",-1)),e("div",It,[(l(!0),o(y,null,h(n.aiInsights,s=>(l(),o("div",{key:s.id,class:"insight-item"},[e("div",wt,i(s.type),1),e("div",At,i(s.content),1),e("div",kt,i(r.formatDate(s.timestamp)),1)]))),128))])])):u("",!0),e("div",St,[e("button",{onClick:t[14]||(t[14]=(...s)=>r.testAPI&&r.testAPI(...s)),class:"test-btn"}," 🧪 测试AI生成API ")])])}const bt=k(P,[["render",Pt],["__scopeId","data-v-7509ae4c"]]);export{bt as default};
