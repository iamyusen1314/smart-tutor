<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>å°ç¨‹åºç½‘ç»œè¯Šæ–­</title>
    <style>
        body { font-family: Arial; padding: 20px; background: #f5f5f5; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 20px; border-radius: 10px; }
        .section { margin-bottom: 20px; padding: 15px; background: #f9f9f9; border-radius: 8px; }
        .btn { padding: 10px 20px; margin: 5px; background: #007aff; color: white; border: none; border-radius: 5px; cursor: pointer; }
        .result { margin: 10px 0; padding: 10px; border-radius: 5px; font-family: monospace; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .info { background: #d1ecf1; color: #0c5460; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”§ å°ç¨‹åºç½‘ç»œè¯Šæ–­</h1>
        
        <div class="section">
            <h3>ğŸ“Š å½“å‰é…ç½®</h3>
            <p><strong>æœåŠ¡å™¨åœ°å€:</strong> http://192.168.31.180:3000</p>
            <p><strong>å°ç¨‹åºé…ç½®:</strong> miniprogram/app.js</p>
        </div>

        <div class="section">
            <h3>ğŸš€ å¿«é€Ÿæµ‹è¯•</h3>
            <button class="btn" onclick="testAll()">å¼€å§‹è¯Šæ–­</button>
            <button class="btn" onclick="clearResults()">æ¸…é™¤ç»“æœ</button>
        </div>

        <div class="section">
            <h3>ğŸ“‹ æµ‹è¯•ç»“æœ</h3>
            <div id="results"></div>
        </div>

        <div class="section">
            <h3>ğŸ’¡ å¸¸è§é—®é¢˜è§£å†³æ–¹æ¡ˆ</h3>
            <div id="solutions">
                <div class="result info">
                    <strong>å¦‚æœæµ‹è¯•å¤±è´¥ï¼š</strong><br>
                    1. æ£€æŸ¥æœåŠ¡å™¨æ˜¯å¦å¯åŠ¨åœ¨ 3000 ç«¯å£<br>
                    2. ç¡®è®¤æœåŠ¡å™¨ç›‘å¬ 0.0.0.0:3000 è€Œé localhost:3000<br>
                    3. å¾®ä¿¡å¼€å‘è€…å·¥å…·ä¸­å¼€å¯"ä¸æ ¡éªŒåˆæ³•åŸŸå"<br>
                    4. æ£€æŸ¥ IP åœ°å€æ˜¯å¦æ­£ç¡®: 192.168.31.180
                </div>
                <div class="result info">
                    <strong>å°ç¨‹åºç«¯æ£€æŸ¥ï¼š</strong><br>
                    1. app.js ä¸­ globalData.apiHost é…ç½®<br>
                    2. utils/util.js ä¸­ request å‡½æ•°<br>
                    3. ç½‘ç»œè¯·æ±‚çš„é”™è¯¯å¤„ç†é€»è¾‘<br>
                    4. æ§åˆ¶å°é”™è¯¯ä¿¡æ¯
                </div>
            </div>
        </div>
    </div>

    <script>
        const serverHost = 'http://192.168.31.180:3000';

        function addResult(message, type) {
            const results = document.getElementById('results');
            const div = document.createElement('div');
            div.className = `result ${type}`;
            div.innerHTML = `[${new Date().toLocaleTimeString()}] ${message}`;
            results.appendChild(div);
        }

        function clearResults() {
            document.getElementById('results').innerHTML = '';
        }

        async function testConnection() {
            try {
                const response = await fetch(`${serverHost}/health`);
                if (response.ok) {
                    const data = await response.json();
                    addResult(`âœ… åŸºç¡€è¿æ¥æˆåŠŸ - çŠ¶æ€: ${data.status}`, 'success');
                    return true;
                } else {
                    addResult(`âŒ åŸºç¡€è¿æ¥å¤±è´¥ - HTTP ${response.status}`, 'error');
                    return false;
                }
            } catch (error) {
                addResult(`âŒ åŸºç¡€è¿æ¥å¤±è´¥ - ${error.message}`, 'error');
                return false;
            }
        }

        async function testAIChat() {
            try {
                const response = await fetch(`${serverHost}/api/ai-chat/tutoring`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        question: '1+1=?',
                        studentInput: 'æˆ‘ä¸çŸ¥é“',
                        subject: 'math',
                        grade: 1,
                        currentStep: 'understanding'
                    })
                });
                
                if (response.ok) {
                    const data = await response.json();
                    addResult(`âœ… AIèŠå¤©æ¥å£æ­£å¸¸ - æ¨¡å‹: ${data.data?.model || 'æœªçŸ¥'}`, 'success');
                    return true;
                } else {
                    addResult(`âŒ AIèŠå¤©æ¥å£å¤±è´¥ - HTTP ${response.status}`, 'error');
                    return false;
                }
            } catch (error) {
                addResult(`âŒ AIèŠå¤©æ¥å£å¤±è´¥ - ${error.message}`, 'error');
                return false;
            }
        }

        async function testAll() {
            addResult('ğŸš€ å¼€å§‹ç½‘ç»œè¯Šæ–­...', 'info');
            
            const connectionOK = await testConnection();
            if (connectionOK) {
                await testAIChat();
            }
            
            addResult('âœ… è¯Šæ–­å®Œæˆï¼', 'info');
        }

        // é¡µé¢åŠ è½½æ—¶æç¤º
        window.addEventListener('load', () => {
            addResult('ğŸ”§ è¯Šæ–­å·¥å…·å·²å‡†å¤‡å°±ç»ªï¼Œç‚¹å‡»"å¼€å§‹è¯Šæ–­"æŒ‰é’®æµ‹è¯•', 'info');
        });
    </script>
</body>
</html> 