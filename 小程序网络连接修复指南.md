# 🔧 小程序网络连接问题紧急修复指南

## 📊 问题诊断

**症状**：
- 错误信息：`网络连接失败，请检查网络`
- 调用栈显示：`request.js → learningDataService.js → ai-chat.js`
- 后端服务器正常运行在 `http://192.168.33.116:3000`

**根本原因**：微信小程序的网络安全策略阻止了对本地开发服务器的请求

## 🎯 立即修复步骤

### 步骤1：开发者工具网络设置
1. 打开微信开发者工具
2. 点击右上角 **详情** 按钮
3. 在 **本地设置** 标签页中：
   - ✅ **勾选**：`不校验合法域名、web-view(业务域名)、TLS版本以及HTTPS证书`
   - ✅ **勾选**：`启用调试模式`
4. 点击 **确定** 保存设置

### 步骤2：清除缓存重编译
1. 在开发者工具中点击 **清缓存**
2. 选择 **清除所有缓存**
3. 重新点击 **编译** 按钮
4. 等待编译完成

### 步骤3：验证网络连接
在小程序控制台中执行以下测试代码：

```javascript
// 测试基础网络连接
wx.request({
  url: 'http://192.168.33.116:3000/health',
  method: 'GET',
  timeout: 10000,
  success: (res) => {
    console.log('✅ 网络连接成功:', res.data)
  },
  fail: (err) => {
    console.error('❌ 网络连接失败:', err)
  }
})
```

### 步骤4：检查IP地址配置
确认后端服务器的IP地址是否正确：

```bash
# 在终端中检查当前IP
ifconfig | grep "inet " | grep -v "127.0.0.1"
```

当前配置的IP是：`192.168.33.116`

## 🔧 替代解决方案

### 方案A：使用localhost（如果IP有问题）
修改小程序中的API地址为：`http://localhost:3000`

### 方案B：重启网络服务
```bash
# 重启MongoDB和后端服务
pkill -f "mongod|node.*app"
sleep 3
./mongodb-macos-aarch64-8.0.10/bin/mongod --config mongodb.conf &
sleep 5
cd server && npm start
```

## 📋 验证清单

请按顺序检查以下项目：

- [ ] 微信开发者工具已关闭域名校验
- [ ] 已清除所有缓存并重新编译
- [ ] 后端服务器正常运行（访问 http://192.168.33.116:3000/health）
- [ ] IP地址配置正确
- [ ] 小程序控制台测试网络请求成功

## 🚨 如果仍然失败

1. **重启微信开发者工具**
2. **检查防火墙设置**（确保端口3000未被阻止）
3. **使用真机调试**（排除开发者工具问题）

## 📞 紧急联系

如果问题仍未解决，请提供以下信息：
- 微信开发者工具版本
- 执行 `curl http://192.168.33.116:3000/health` 的结果
- 小程序控制台的完整错误信息 