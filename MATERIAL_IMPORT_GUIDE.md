# 📚 教材数据导入系统使用指南

## 🎯 系统概述

我们为您的小学AI家教系统开发了一套完整的教材数据导入解决方案，支持合规、安全地管理教材内容。

### ⚖️ 关于国家智慧教育平台数据

**无法直接爬取的原因：**
1. **版权保护**：国家智慧教育平台内容受法律保护
2. **技术限制**：需要官方API密钥和白名单审核
3. **合规要求**：需要遵循平台服务商协议

**推荐的合规方案：**
1. 申请官方API接入（需要企业资质）
2. 使用我们提供的手动导入系统
3. 与内容提供商合作获取授权

## 🏗️ 系统架构

### 后端API接口
```
├── POST /api/materials/upload     # 文件批量上传
├── POST /api/materials/manual     # 手动录入题目
├── GET  /api/materials/template   # 下载导入模板
├── GET  /api/materials/search     # 搜索教材内容
└── GET  /api/materials/stats      # 获取统计信息
```

### 前端页面
```
├── miniprogram/pages/materials/   # 教材管理页面
│   ├── materials.js              # 页面逻辑
│   ├── materials.wxml            # 页面模板
│   ├── materials.wxss            # 页面样式
│   └── materials.json            # 页面配置
```

### 数据模型
- **Question** - 题目库模型，支持多种题型
- **Plan** - 学习计划模型
- **BatchCorrection** - 批改结果模型
- **Report** - 学习报告模型

## 🚀 快速开始

### 1. 启动系统

```bash
# 启动数据库
# MongoDB 应该已经在运行在 localhost:27017

# 启动后端服务
cd server
npm start

# 后端将在 http://localhost:3000 运行
```

### 2. 访问教材管理页面

在微信开发者工具中打开小程序，导航到教材管理页面。

## 📖 功能详解

### 🔽 1. 模板下载功能

**使用步骤：**
1. 点击"下载Excel模板"按钮
2. 选择学科和年级
3. 获得标准格式的Excel模板

**模板字段说明：**
- **题目标题**：题目的简短标题
- **题目内容**：完整的题目描述
- **题目类型**：choice, fill_blank, calculation, essay, true_false
- **学科**：math, chinese, english
- **年级**：1-6
- **知识点**：用逗号分隔多个知识点
- **难度**：easy, normal, hard
- **答案**：正确答案
- **解析**：详细解题过程
- **提示1-3**：不同级别的提示
- **标签**：用逗号分隔的标签
- **预估用时**：完成时间（分钟）
- **选项A-D**：选择题选项（非选择题留空）
- **正确选项**：选择题答案（A/B/C/D）

### 📤 2. 文件上传功能

**支持格式：**
- Excel (.xlsx)
- JSON (.json)
- CSV (.csv)

**上传步骤：**
1. 按模板格式准备数据文件
2. 点击上传区域选择文件
3. 选择学科和年级
4. 等待上传和处理完成

**数据验证：**
- 自动验证必需字段
- 标准化数据格式
- 生成唯一题目ID
- 错误报告和修复建议

### ✏️ 3. 手动录入功能

**适用场景：**
- 少量题目录入
- 特殊格式题目
- 临时补充内容

**录入界面包含：**
- 题目基本信息
- 答案和解析
- 知识点标签
- 难度设置
- 预估时间

### 🔍 4. 搜索功能

**搜索条件：**
- 学科筛选
- 年级筛选
- 难度筛选
- 题型筛选
- 关键词搜索

**搜索结果：**
- 分页显示
- 题目预览
- 标签展示
- 点击查看详情

### 📊 5. 统计功能

**统计维度：**
- 总体数据：题目总数、学科覆盖、年级分布
- 分学科统计：各学科题目数量和年级分布
- 难度分析：各难度级别的题目分布
- 类型分析：各题型的数量统计

## 🧪 测试验证

我们提供了完整的测试脚本来验证功能：

```bash
cd server
node test-materials.js
```

**测试项目：**
- ✅ 模板下载测试
- ✅ 手动录入测试
- ✅ Excel上传测试
- ✅ 搜索功能测试
- ✅ 统计功能测试

## 📝 数据示例

### Excel导入示例数据

```excel
题目标题          | 题目内容           | 题目类型    | 学科  | 年级 | 知识点
加法练习题        | 计算 25 + 37 = ?  | calculation | math  | 2    | 两位数加法,进位
选择题练习        | 哪个计算正确？     | choice      | math  | 2    | 基础运算
```

### JSON导入示例

```json
[
  {
    "title": "加法练习题",
    "content": "计算 25 + 37 = ?",
    "type": "calculation",
    "subject": "math",
    "grade": 2,
    "knowledgePoints": ["两位数加法", "进位"],
    "difficulty": "normal",
    "answer": "62",
    "explanation": "先算个位：5+7=12，写2进1；再算十位：2+3+1=6",
    "hints": [
      {"level": 1, "content": "先从个位开始计算"},
      {"level": 2, "content": "注意进位"}
    ],
    "tags": ["计算", "加法", "进位"],
    "estimatedTime": 3
  }
]
```

## 🔧 高级配置

### 环境变量设置

```bash
# .env 文件
PORT=3000
MONGODB_URI=mongodb://localhost:27017/smart_tutor
UPLOAD_MAX_SIZE=50mb
ALLOWED_ORIGINS=http://localhost:3000
```

### 自定义数据验证

可以在 `server/src/routes/materials.js` 中的 `validateAndNormalizeMaterials` 函数里添加自定义验证逻辑：

```javascript
// 添加自定义验证规则
if (questionData.estimatedTime > 60) {
  errors.push(`第${i + 1}行：预估时间不能超过60分钟`)
}

// 添加知识点标准化
knowledgePoints = knowledgePoints.map(point => {
  return standardizeKnowledgePoint(point)
})
```

### 批量操作优化

对于大量数据导入，建议：
1. 分批上传（每批不超过1000条）
2. 使用事务处理确保数据一致性
3. 异步处理减少响应时间

## 🛡️ 安全注意事项

### 文件上传安全
- 文件类型验证
- 文件大小限制（50MB）
- 恶意内容检测
- 临时文件清理

### 数据验证
- 输入字段验证
- SQL注入防护
- XSS攻击防护
- 数据完整性检查

### 访问控制
- 用户身份验证
- 权限级别控制
- 操作日志记录

## 🐛 常见问题

### Q1: 上传失败 "文件格式不支持"
**解决方案：**
- 确保文件是 .xlsx、.json 或 .csv 格式
- 检查文件是否损坏
- 文件大小不超过50MB

### Q2: 数据验证失败
**解决方案：**
- 检查必需字段是否完整
- 确认数据格式符合要求
- 查看详细错误信息进行修正

### Q3: 搜索结果为空
**解决方案：**
- 确认数据已成功导入
- 调整搜索条件
- 检查数据库连接状态

### Q4: 统计数据不准确
**解决方案：**
- 刷新页面重新加载
- 检查数据库索引
- 清理无效数据

## 📞 技术支持

如果遇到技术问题，请：

1. **查看日志**：
   ```bash
   cd server
   npm run logs
   ```

2. **运行测试**：
   ```bash
   node test-materials.js
   ```

3. **检查数据库**：
   ```bash
   mongo smart_tutor
   db.questions.count()
   ```

4. **重启服务**：
   ```bash
   npm restart
   ```

## 🔄 后续扩展

### 计划中的功能
- [ ] 题目批量编辑
- [ ] 导出功能
- [ ] 版本控制
- [ ] 审核流程
- [ ] AI辅助生成题目
- [ ] 多媒体内容支持

### 集成建议
- 与现有OCR系统集成，支持图片识别导入
- 与AI对话系统集成，自动生成相关题目
- 与学习计划系统集成，智能推荐题目

---

## 📋 总结

本教材数据导入系统提供了：

✅ **合规的数据获取方案** - 避免版权风险  
✅ **完整的导入功能** - 支持多种格式  
✅ **强大的搜索能力** - 快速定位内容  
✅ **详细的统计分析** - 了解数据分布  
✅ **友好的用户界面** - 易于操作使用  
✅ **完善的测试验证** - 确保功能稳定  

通过这套系统，您可以安全、高效地管理教材内容，为AI家教系统提供丰富的题库资源。如需进一步的定制开发或技术支持，请随时联系我们。 