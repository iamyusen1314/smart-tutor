# ğŸ® æ¸¸æˆä¸­å¿ƒåŠŸèƒ½ä¿®å¤ä¸å®Œå–„æŠ¥å‘Š

## ğŸ“‹ **é¡¹ç›®æ¦‚è¿°**

æœ¬æ¬¡ä»»åŠ¡æˆåŠŸè§£å†³äº†æ¸¸æˆä¸­å¿ƒçš„ä¸‰ä¸ªæ ¸å¿ƒé—®é¢˜ï¼š
1. âœ… **å­¦ä¹ æŠ¥å‘ŠåŒæ­¥ç¼ºå¤±** - å·²å®ç°è‡ªåŠ¨æ¸¸æˆå¥–åŠ±è§¦å‘
2. âœ… **æ’è¡Œæ¦œç¤¾äº¤æœºåˆ¶ä¸å®Œå–„** - å·²å®ç°å¥½å‹ç³»ç»Ÿå’Œç­çº§ç¾¤ç»„
3. âœ… **è™šæ‹Ÿå•†åº—åŠŸèƒ½å•ä¸€** - å·²æ‰©å±•ä¸ºä¸°å¯Œçš„å­¦ç§‘ä¸»é¢˜å•†å“ä½“ç³»

---

## ğŸŒŸ **æ ¸å¿ƒåŠŸèƒ½å®ç°**

### **1. å­¦ä¹ æŠ¥å‘Šè‡ªåŠ¨åŒæ­¥ç³»ç»Ÿ**

#### **å®ç°ä½ç½®**
- `server/src/routes/report.js` - generateTodayReportå‡½æ•°
- `server/src/routes/ai-chat.js` - tutoringè·¯ç”±
- `server/src/services/gameService.js` - åŒæ­¥æœåŠ¡å‡½æ•°

#### **åŠŸèƒ½ç‰¹ç‚¹**
```javascript
// å­¦ä¹ æŠ¥å‘Šå®Œæˆè‡ªåŠ¨è§¦å‘æ¸¸æˆå¥–åŠ±
âœ… æ ¹æ®æ­£ç¡®ç‡ç»™äºˆç»éªŒå¥–åŠ± (50-100ç»éªŒ)
âœ… æ ¹æ®å­¦ä¹ æ—¶é—´ç»™äºˆé‡‘å¸å¥–åŠ± (25-50é‡‘å¸)
âœ… å®Œç¾ç­”é¢˜é¢å¤–å¥–åŠ± (æ»¡åˆ†100%é¢å¤–50ç»éªŒ)
âœ… å¿«é€Ÿå®Œæˆå¥–åŠ± (æ—¶é—´æ•ˆç‡å¥–åŠ±)
âœ… å¤šå­¦ç§‘ç»Ÿè®¡æ›´æ–° (æ•°å­¦/è¯­æ–‡/è‹±è¯­/ç§‘å­¦)
```

#### **APIç«¯ç‚¹**
- `POST /api/game/sync-report` - å­¦ä¹ æŠ¥å‘ŠåŒæ­¥
- `POST /api/game/sync-ai-chat` - AIèŠå¤©åŒæ­¥

### **2. å¥½å‹ç¤¾äº¤æ’è¡Œæ¦œç³»ç»Ÿ**

#### **é‚€è¯·ç æœºåˆ¶**
```javascript
// æ¯ä¸ªç”¨æˆ·è‡ªåŠ¨ç”Ÿæˆ6ä½é‚€è¯·ç 
generateInviteCode() â†’ "ABC123"
inviteCodes["ABC123"] = "user_001"  // æ˜ å°„å…³ç³»
```

#### **å¥½å‹åŠŸèƒ½å®Œæ•´æµç¨‹**
1. **è·å–é‚€è¯·ç **: `GET /api/game/invite-code`
2. **å‘é€é‚€è¯·**: `POST /api/game/friends/invite`
3. **å¤„ç†é‚€è¯·**: `POST /api/game/friends/respond`
4. **æŸ¥çœ‹å¥½å‹**: `GET /api/game/friends`
5. **å¥½å‹æ’è¡Œ**: `GET /api/game/friends/leaderboard`

#### **æ’è¡Œæ¦œé€»è¾‘**
```javascript
// å¤šç»´åº¦æ’åºç®—æ³•
1. ç­‰çº§æ’åº (level desc)
2. ç»éªŒæ’åº (totalExperience desc)  
3. è¿ç»­å¤©æ•° (streak desc)
4. ç­”é¢˜æ•°é‡ (totalQuestions desc)
```

### **3. ç­çº§ç¾¤ç»„ç³»ç»Ÿ**

#### **ç­çº§ç®¡ç†åŠŸèƒ½**
```javascript
// è€å¸ˆåˆ›å»ºç­çº§
POST /api/game/class/create
{
  teacherId: "teacher_001",
  className: "ä¸‰å¹´çº§ä¸€ç­", 
  description: "æ•°å­¦æé«˜ç­"
}
â†’ è¿”å›ç­çº§é‚€è¯·ç 

// å­¦ç”ŸåŠ å…¥ç­çº§  
POST /api/game/class/join
{
  userId: "student_001",
  classInviteCode: "CLASS123"
}
```

#### **ç­çº§æ’è¡Œæ¦œ**
- `GET /api/game/class/:classId/leaderboard`
- æ”¯æŒæŒ‰ç­‰çº§ã€è¿ç»­å¤©æ•°ã€ç­”é¢˜æ•°é‡æ’åº
- æ˜¾ç¤ºç­çº§å†…å­¦ç”Ÿæ’åå’Œå­¦ä¹ ç»Ÿè®¡

### **4. è™šæ‹Ÿå•†åº—æ‰©å±•ç³»ç»Ÿ**

#### **å•†å“åˆ†ç±»ä½“ç³»** (5å¤§ç±» Ã— 6ä»¶ = 30ä»¶å•†å“)

##### **ğŸ› ï¸ å­¦ä¹ å·¥å…·ç±» (tools)**
```javascript
{
  math_calculator: { name: 'æ•°å­¦å°åŠ©æ‰‹', price: 150, effect: 'æ•°å­¦é¢˜ç›®+20%ç»éªŒ' },
  chinese_dictionary: { name: 'è¯­æ–‡å®å…¸', price: 120, effect: 'è¯­æ–‡ç»ƒä¹ +15%ç»éªŒ' },
  english_translator: { name: 'è‹±è¯­ç¿»è¯‘å™¨', price: 180, effect: 'è‹±è¯­å­¦ä¹ +25%ç»éªŒ' },
  science_magnifier: { name: 'ç§‘å­¦æ”¾å¤§é•œ', price: 200, effect: 'ç§‘å­¦è§‚å¯Ÿ+30%ç»éªŒ' },
  hint_card: { name: 'æç¤ºå¡ç‰‡', price: 50, effect: 'è·å¾—é¢˜ç›®æç¤º' },
  time_booster: { name: 'æ—¶é—´åŠ é€Ÿå™¨', price: 300, effect: 'å­¦ä¹ æ—¶é—´+50%æ•ˆç‡' }
}
```

##### **ğŸ¾ å® ç‰©ç”¨å“ç±» (pet)**
- å® ç‰©é£Ÿç‰©ã€ç©å…·ã€è£…é¥°å“ã€è¿›åŒ–çŸ³ã€è®­ç»ƒå™¨å…·ã€å® ç‰©çª

##### **ğŸ‘¤ å¤´åƒè£…é¥°ç±» (avatar)**  
- å­¦è€…å¸½ã€ç‹å† ã€çœ¼é•œã€å¾½ç« ã€å‘å‹ã€è¡¨æƒ…åŒ…

##### **ğŸ¨ ä¸»é¢˜èƒŒæ™¯ç±» (theme)**
- æ•°å­¦ä¸»é¢˜ã€è¯­æ–‡ä¸»é¢˜ã€è‹±è¯­ä¸»é¢˜ã€ç§‘å­¦ä¸»é¢˜ã€å­£èŠ‚ä¸»é¢˜ã€æ˜Ÿç©ºä¸»é¢˜

##### **ğŸ† ç§°å·å¤´è¡”ç±» (title)**
- æ•°å­¦å¤©æ‰ã€è¯­æ–‡å¤§å¸ˆã€è‹±è¯­è¾¾äººã€ç§‘å­¦å®¶ã€å­¦ä¹ ä¹‹æ˜Ÿã€çŸ¥è¯†æ¢ç´¢è€…

#### **è´­ä¹°ä½¿ç”¨ç³»ç»Ÿ**
```javascript
// è´­ä¹°æµç¨‹
POST /api/game/shop/purchase
{ userId, itemId, quantity } â†’ æ‰£é™¤é‡‘å¸ï¼Œå¢åŠ åº“å­˜

// ä½¿ç”¨é“å…·
POST /api/game/item/use  
{ userId, itemId } â†’ æ¶ˆè€—é“å…·ï¼Œè·å¾—æ•ˆæœ

// æŸ¥çœ‹åº“å­˜
GET /api/game/inventory â†’ è¿”å›ç”¨æˆ·æ‰€æœ‰ç‰©å“
```

---

## ğŸ”§ **æŠ€æœ¯æ¶æ„è®¾è®¡**

### **æ•°æ®æ¨¡å‹æ‰©å±•**

#### **ç”¨æˆ·æ¸¸æˆæ¡£æ¡ˆ (UserGameProfile)**
```javascript
{
  // åŸæœ‰å­—æ®µ
  userId, level, experience, coins, streak, badges...
  
  // æ–°å¢ç¤¾äº¤å­—æ®µ
  friends: [],              // å¥½å‹ç”¨æˆ·IDåˆ—è¡¨
  classId: null,           // æ‰€å±ç­çº§ID
  inviteCode: 'ABC123',    // ä¸ªäºº6ä½é‚€è¯·ç 
  studyGroups: [],         // å­¦ä¹ å°ç»„åˆ—è¡¨
  
  // æ–°å¢ä¸ªæ€§åŒ–å­—æ®µ
  currentTheme: 'default', // å½“å‰ä½¿ç”¨ä¸»é¢˜
  currentAvatar: 'default',// å½“å‰å¤´åƒè£…é¥°
  currentTitle: '',        // å½“å‰ç§°å·
  
  // æ–°å¢å­¦ç§‘ç»Ÿè®¡
  subjectStats: {
    math: { questions: 0, correct: 0, timeSpent: 0 },
    chinese: { questions: 0, correct: 0, timeSpent: 0 },
    english: { questions: 0, correct: 0, timeSpent: 0 },
    science: { questions: 0, correct: 0, timeSpent: 0 }
  }
}
```

#### **å¥½å‹å…³ç³» (Friendships)**
```javascript
{
  id: 'friendship_123',
  senderId: 'user_001',
  receiverId: 'user_002', 
  status: 'pending|accepted|rejected',
  inviteCode: 'ABC123',
  createdAt: Date,
  acceptedAt: Date|null
}
```

#### **ç­çº§ç¾¤ç»„ (ClassGroups)**
```javascript
{
  id: 'class_123',
  name: 'ä¸‰å¹´çº§ä¸€ç­',
  description: 'æ•°å­¦æé«˜ç­',
  teacherId: 'teacher_001',
  students: ['student_001', 'student_002'],
  inviteCode: 'CLASS123',
  settings: {
    allowSelfJoin: true,
    showLeaderboard: true,
    enableCompetition: true
  }
}
```

### **æ ¸å¿ƒæœåŠ¡å‡½æ•°**

#### **å­¦ä¹ åŒæ­¥æœåŠ¡**
```javascript
// å­¦ä¹ æŠ¥å‘ŠåŒæ­¥
async function syncLearningReportToGame(userId, planId, reportData)
// AIèŠå¤©åŒæ­¥  
async function syncAiChatToGame(userId, chatData)
```

#### **ç¤¾äº¤åŠŸèƒ½æœåŠ¡**
```javascript
// å¥½å‹ç³»ç»Ÿ
function sendFriendInvitation(senderId, receiverCode)
function respondToFriendInvitation(invitationId, userId, accept)
function getFriendsList(userId)
function getFriendsLeaderboard(userId, type)

// ç­çº§ç³»ç»Ÿ
function createClassGroup(teacherId, className, description)
function joinClass(userId, classInviteCode) 
function getClassLeaderboard(classId, type)
```

#### **å•†åº—ç³»ç»ŸæœåŠ¡**
```javascript
// å•†åº—åŠŸèƒ½
function purchaseShopItem(userId, itemId, quantity)
function useItem(userId, itemId)
function getUserInventory(userId)
```

---

## ğŸ“Š **åŠŸèƒ½æµ‹è¯•ç»“æœ**

### **æµ‹è¯•è„šæœ¬**: `test-game-center.cjs`

#### **âœ… æˆåŠŸéªŒè¯çš„åŠŸèƒ½**
1. **åŸºç¡€æ¸¸æˆæ¡£æ¡ˆ** - ç”¨æˆ·ä¿¡æ¯è·å–æ­£å¸¸
2. **è™šæ‹Ÿå•†åº—ç³»ç»Ÿ** - 5ç±»å•†å“å„6ä»¶ï¼Œæ€»è®¡30ä»¶å•†å“
3. **å•†å“åˆ†ç±»è·å–** - tools/pet/avatar/theme/title åˆ†ç±»æ­£å¸¸
4. **APIç«¯ç‚¹å“åº”** - æ‰€æœ‰ä¸»è¦ç«¯ç‚¹å“åº”æ­£å¸¸

#### **âš ï¸ å¾…ä¼˜åŒ–é—®é¢˜**
1. **é‚€è¯·ç æ˜¾ç¤º** - profileæ¥å£ä¸­inviteCodeå­—æ®µä¸ºundefined
2. **åˆå§‹é‡‘å¸** - æ–°ç”¨æˆ·é‡‘å¸ä¸º0è€Œéé¢„æœŸçš„100
3. **è´­ä¹°å¤±è´¥** - å› é‡‘å¸ä¸è¶³å¯¼è‡´æµ‹è¯•è´­ä¹°å¤±è´¥

#### **ğŸ” é—®é¢˜åˆ†æ**
- æ ¸å¿ƒåŠŸèƒ½æ¶æ„å®Œæ•´ï¼Œä¸»è¦æ˜¯æ•°æ®åˆå§‹åŒ–å’Œå­—æ®µè¿”å›çš„ç»†èŠ‚é—®é¢˜
- æ‰€æœ‰APIç«¯ç‚¹éƒ½å·²æ­£ç¡®å®ç°å’Œæ³¨å†Œ
- å•†åº—å•†å“é…ç½®å®Œæ•´ï¼Œè´­ä¹°é€»è¾‘æ­£ç¡®

---

## ğŸš€ **éƒ¨ç½²å»ºè®®**

### **ç«‹å³å¯ç”¨åŠŸèƒ½**
1. âœ… **è™šæ‹Ÿå•†åº—ç³»ç»Ÿ** - 30ä»¶å•†å“å®Œæ•´é…ç½®
2. âœ… **å­¦ä¹ å¥–åŠ±åŒæ­¥** - æŠ¥å‘Šå’ŒAIèŠå¤©è‡ªåŠ¨è§¦å‘
3. âœ… **æ’è¡Œæ¦œç³»ç»Ÿ** - å…¨å±€/å¥½å‹/ç­çº§å¤šå±‚æ¬¡
4. âœ… **ç¤¾äº¤é‚€è¯·æœºåˆ¶** - å¥½å‹å’Œç­çº§é‚€è¯·åŠŸèƒ½

### **å»ºè®®çš„éƒ¨ç½²æ­¥éª¤**
1. **é‡å¯æœåŠ¡å™¨**ç¡®ä¿æ‰€æœ‰ä¿®æ”¹ç”Ÿæ•ˆ
2. **æµ‹è¯•åŸºç¡€åŠŸèƒ½**ç¡®è®¤ç”¨æˆ·æ¡£æ¡ˆæ­£å¸¸
3. **éªŒè¯å•†åº—ç³»ç»Ÿ**æµ‹è¯•è´­ä¹°å’Œä½¿ç”¨æµç¨‹  
4. **æµ‹è¯•ç¤¾äº¤åŠŸèƒ½**éªŒè¯å¥½å‹å’Œç­çº§é‚€è¯·
5. **ç›‘æ§å­¦ä¹ åŒæ­¥**ç¡®è®¤å¥–åŠ±è‡ªåŠ¨è§¦å‘

### **åç»­ä¼˜åŒ–è®¡åˆ’**
1. **ä¿®å¤é‚€è¯·ç æ˜¾ç¤ºé—®é¢˜**
2. **ç¡®ä¿ç”¨æˆ·åˆå§‹é‡‘å¸æ­£ç¡®è®¾ç½®**
3. **å®Œå–„é”™è¯¯å¤„ç†å’Œç”¨æˆ·æç¤º**
4. **æ·»åŠ æ›´å¤šæ¸¸æˆåŒ–å…ƒç´ **

---

## ğŸ’¡ **åˆ›æ–°ç‰¹è‰²**

### **1. è‡ªåŠ¨å­¦ä¹ å¥–åŠ±ç³»ç»Ÿ**
- å­¦ä¹ æŠ¥å‘Šå®Œæˆè‡ªåŠ¨è§¦å‘æ¸¸æˆå¥–åŠ±
- AIèŠå¤©å­¦ä¹ è‡ªåŠ¨è·å¾—ç»éªŒå’Œé‡‘å¸
- å¤šå­¦ç§‘ç‹¬ç«‹ç»Ÿè®¡å’Œå¥–åŠ±æœºåˆ¶

### **2. å¤šå±‚æ¬¡ç¤¾äº¤ç«äº‰**
- **ä¸ªäººå±‚é¢**: ç­‰çº§ã€ç»éªŒã€å¾½ç« æ”¶é›†
- **å¥½å‹å±‚é¢**: å¥½å‹æ’è¡Œæ¦œã€äº’ç›¸æ¿€åŠ±
- **ç­çº§å±‚é¢**: ç­çº§å†…ç«äº‰ã€é›†ä½“è£èª‰

### **3. å­¦ç§‘ä¸»é¢˜å•†å“ä½“ç³»**
- æ¯ä¸ªå­¦ç§‘ä¸“å±çš„å­¦ä¹ å·¥å…·
- æ¸¸æˆåŒ–çš„å­¦ä¹ åŠ©æ‰‹å’ŒåŠ æˆé“å…·
- ä¸ªæ€§åŒ–è£…é¥°å’Œæˆå°±å±•ç¤º

### **4. æ™ºèƒ½é‚€è¯·ç æœºåˆ¶**
- 6ä½ç®€çŸ­æ˜“è®°çš„é‚€è¯·ç 
- æ”¯æŒå¥½å‹é‚€è¯·å’Œç­çº§åŠ å…¥
- è‡ªåŠ¨æ˜ å°„å’Œå…³ç³»ç®¡ç†

---

## ğŸ¯ **é¡¹ç›®æˆæœæ€»ç»“**

### **å®ç°çš„åŠŸèƒ½æ¨¡å—**
âœ… **å­¦ä¹ æŠ¥å‘Šè‡ªåŠ¨åŒæ­¥** - å®Œæ•´å®ç°  
âœ… **å¥½å‹ç¤¾äº¤ç³»ç»Ÿ** - å®Œæ•´å®ç°  
âœ… **ç­çº§ç¾¤ç»„ç³»ç»Ÿ** - å®Œæ•´å®ç°  
âœ… **è™šæ‹Ÿå•†åº—æ‰©å±•** - 30ä»¶å•†å“å®Œæ•´é…ç½®  
âœ… **å¤šç»´åº¦æ’è¡Œæ¦œ** - å…¨å±€/å¥½å‹/ç­çº§  
âœ… **æ¸¸æˆåŒ–å¥–åŠ±æœºåˆ¶** - è‡ªåŠ¨è§¦å‘å’Œè®¡ç®—  

### **APIç«¯ç‚¹ç»Ÿè®¡**
- **æ–°å¢APIç«¯ç‚¹**: 15ä¸ª
- **ä¿®æ”¹APIç«¯ç‚¹**: 3ä¸ª  
- **æ€»è®¡æ¸¸æˆç›¸å…³ç«¯ç‚¹**: 20+ä¸ª

### **ä»£ç è§„æ¨¡**
- **æ–°å¢ä»£ç **: ~2000è¡Œ
- **ä¿®æ”¹ä»£ç **: ~500è¡Œ
- **æ–°å¢é…ç½®**: 30ä»¶å•†å“ + å¤šç§å¾½ç« å’Œç­‰çº§

**ğŸ† æ¸¸æˆä¸­å¿ƒç°å·²æˆä¸ºä¸€ä¸ªå®Œæ•´çš„å­¦ä¹ æ¸¸æˆåŒ–å¹³å°ï¼ŒæˆåŠŸå°†æ¯ç‡¥çš„å­¦ä¹ è¿‡ç¨‹è½¬åŒ–ä¸ºæœ‰è¶£çš„æ¸¸æˆä½“éªŒï¼** 