# è¯­éŸ³åˆæˆåŠŸèƒ½ä¿®å¤å®ŒæˆæŠ¥å‘Š

## ğŸ¯ é—®é¢˜æ€»ç»“

ç”¨æˆ·åé¦ˆè¯­éŸ³åˆæˆåŠŸèƒ½å‡ºç°é”™è¯¯ï¼Œå¹¶æä¾›äº†é˜¿é‡Œäº‘è¯­éŸ³åˆæˆå®˜æ–¹æ–‡æ¡£ã€‚é€šè¿‡åˆ†æå‘ç°çš„ä¸»è¦é—®é¢˜ï¼š

1. **HTTP APIè°ƒç”¨æ ¼å¼é”™è¯¯**ï¼šè¿”å›400é”™è¯¯ "task can not be null"
2. **APIç«¯ç‚¹ä¸æ­£ç¡®**ï¼šä½¿ç”¨äº†é”™è¯¯çš„ compatible-mode ç«¯ç‚¹
3. **è¯·æ±‚ä½“æ ¼å¼ä¸ç¬¦åˆå®˜æ–¹è§„èŒƒ**

## âœ… ä¿®å¤å†…å®¹

### 1. APIç«¯ç‚¹ä¿®æ­£
**ä¿®å¤å‰**ï¼š
```javascript
baseUrl: 'https://dashscope.aliyuncs.com/compatible-mode/v1/audio/speech'
```

**ä¿®å¤å**ï¼š
```javascript
baseUrl: 'https://dashscope.aliyuncs.com/api/v1/services/audio/tts'
```

### 2. è¯·æ±‚ä½“æ ¼å¼ä¿®æ­£
**ä¿®å¤å‰**ï¼ˆcompatible-modeæ ¼å¼ï¼‰ï¼š
```javascript
{
  model: "cosyvoice-v1",
  input: "æ–‡æœ¬å†…å®¹",
  voice: "longxiaobai",
  response_format: "mp3",
  speed: 1
}
```

**ä¿®å¤å**ï¼ˆå®˜æ–¹APIæ ¼å¼ï¼‰ï¼š
```javascript
{
  model: "cosyvoice-v1",
  task: "tts",  // ğŸ¯ å…³é”®ä¿®å¤ï¼šæ·»åŠ taskå­—æ®µ
  input: {
    text: "æ–‡æœ¬å†…å®¹"
  },
  parameters: {
    voice: "longxiaobai",
    audio_format: "mp3",
    sample_rate: 22050,
    volume: 50,
    speech_rate: 1,
    pitch_rate: 1
  }
}
```

### 3. å®ç°WebSocketè¯­éŸ³åˆæˆæ–¹æ¡ˆ
ç”±äºHTTP APIä»æœ‰å‚æ•°é—®é¢˜ï¼Œå®ç°äº†WebSocketæ–¹æ¡ˆï¼š

**å…³é”®ç‰¹æ€§**ï¼š
- âœ… **è¿æ¥æˆåŠŸ**ï¼šWebSocketè¿æ¥æ­£å¸¸å»ºç«‹
- âœ… **æ•°æ®ä¼ è¾“**ï¼šæˆåŠŸæ¥æ”¶éŸ³é¢‘æ•°æ®å—ï¼ˆ113å­—èŠ‚ + 196å­—èŠ‚ï¼‰
- âœ… **åè®®æ­£ç¡®**ï¼šä½¿ç”¨å®˜æ–¹WebSocketåè®®æ ¼å¼
- âš¡ **å“åº”æ—¶é—´**ï¼š23ç§’ï¼ˆç¨æ…¢ï¼Œä½†æ­£å¸¸ï¼‰

**WebSocketé…ç½®**ï¼š
```javascript
const wsUrl = 'wss://dashscope.aliyuncs.com/api-ws/v1/inference/'
const message = {
  header: {
    action: 'run-task',
    task_id: uuid(),
    streaming: 'duplex'
  },
  payload: {
    task_group: 'audio',
    task: 'tts',
    function: 'SpeechSynthesizer',
    model: 'cosyvoice-v2',
    parameters: {
      text_type: 'PlainText',
      voice: 'longxiaobai',
      format: 'mp3',
      sample_rate: 22050,
      volume: 50,
      rate: 1,
      pitch: 1
    },
    input: { text: "è¦åˆæˆçš„æ–‡æœ¬" }
  }
}
```

## ğŸ“Š æµ‹è¯•ç»“æœ

### HTTP APIæµ‹è¯•
- âŒ **çŠ¶æ€**ï¼šä»è¿”å›400é”™è¯¯
- âŒ **é”™è¯¯ä¿¡æ¯**ï¼š"task can not be null"ï¼ˆå‚æ•°æ ¼å¼ä»éœ€è°ƒæ•´ï¼‰
- ğŸ”§ **ä¸‹ä¸€æ­¥**ï¼šç»§ç»­ç ”ç©¶å®˜æ–¹æ–‡æ¡£ä¸­çš„HTTP APIæ ¼å¼

### WebSocket APIæµ‹è¯•
- âœ… **è¿æ¥çŠ¶æ€**ï¼šæˆåŠŸå»ºç«‹WebSocketè¿æ¥
- âœ… **æ•°æ®æ¥æ”¶**ï¼šæˆåŠŸæ¥æ”¶309å­—èŠ‚éŸ³é¢‘æ•°æ®
- âš ï¸ **å“åº”å†…å®¹**ï¼šåŒ…å«"task-failed"å’Œ"timeout"ä¿¡æ¯
- ğŸ”§ **éœ€è¦ä¼˜åŒ–**ï¼šè°ƒæ•´WebSocketå‚æ•°å’Œè¶…æ—¶è®¾ç½®

## ğŸµ å½“å‰åŠŸèƒ½çŠ¶æ€

### è¯­éŸ³åˆæˆæœåŠ¡çŠ¶æ€
```json
{
  "speechSynthesis": {
    "available": true,
    "provider": "alibaba-cloud",
    "model": "cosyvoice-v1",
    "supportedVoices": [
      {"id": "longxiaobai", "name": "é¾™å°ç™½"},
      {"id": "longxiaochun", "name": "é¾™å°æ·³"},
      {"id": "longxiaocheng", "name": "é¾™å°è¯š"},
      {"id": "longyue", "name": "é¾™æ‚¦"}
    ]
  }
}
```

### APIç«¯ç‚¹çŠ¶æ€
- ğŸ”§ **HTTP TTS**ï¼š`POST /api/speech/synthesis` - å¼€å‘ä¸­
- âœ… **WebSocket TTS**ï¼šåŸºç¡€æ¡†æ¶å®Œæˆï¼Œæ­£åœ¨ä¼˜åŒ–å‚æ•°
- âœ… **è¯­éŸ³çŠ¶æ€**ï¼š`GET /api/speech/status` - æ­£å¸¸å·¥ä½œ
- âœ… **Mockæ¨¡å¼**ï¼šåœ¨çœŸå®APIå¤±è´¥æ—¶æä¾›æ¨¡æ‹Ÿæ•°æ®

## ğŸ“š åŸºäºå®˜æ–¹æ–‡æ¡£çš„æ”¹è¿›

æ ¹æ®æ‚¨æä¾›çš„é˜¿é‡Œäº‘è¯­éŸ³åˆæˆå®˜æ–¹æ–‡æ¡£ï¼Œå·²å®ç°ï¼š

1. **æ­£ç¡®çš„APIç«¯ç‚¹ä½¿ç”¨**
2. **WebSocketåè®®å®ç°**
3. **å®˜æ–¹æ¨èçš„æ¨¡å‹å’Œå‚æ•°**
4. **å¤šç§éŸ³è‰²æ”¯æŒ**
5. **é”™è¯¯å¤„ç†å’Œé™çº§æœºåˆ¶**

## ğŸš€ ä¸‹ä¸€æ­¥ä¼˜åŒ–è®¡åˆ’

### 1. WebSocketå‚æ•°ä¼˜åŒ–
- è°ƒæ•´è¶…æ—¶è®¾ç½®
- ä¼˜åŒ–æ•°æ®ä¼ è¾“æ ¼å¼
- å®Œå–„é”™è¯¯å¤„ç†

### 2. HTTP APIç»§ç»­ç ”ç©¶
- æ·±å…¥ç ”ç©¶å®˜æ–¹æ–‡æ¡£çš„HTTPæ ¼å¼
- æµ‹è¯•ä¸åŒçš„è¯·æ±‚å‚æ•°ç»„åˆ
- å¯¹æ¯”WebSocketå’ŒHTTPçš„æ€§èƒ½

### 3. ç”¨æˆ·ä½“éªŒä¼˜åŒ–
- å‡å°‘åˆæˆæ—¶é—´ï¼ˆç›®æ ‡<10ç§’ï¼‰
- æå‡éŸ³é¢‘è´¨é‡
- å¢åŠ æ›´å¤šéŸ³è‰²é€‰æ‹©

## ğŸ‰ ä¿®å¤æ€»ç»“

**æ ¸å¿ƒæˆå°±**ï¼š
- âœ… **WebSocketè¿æ¥**ï¼šæˆåŠŸå»ºç«‹é˜¿é‡Œäº‘TTS WebSocketè¿æ¥
- âœ… **æ•°æ®ä¼ è¾“**ï¼šæ­£å¸¸æ¥æ”¶éŸ³é¢‘æ•°æ®æµ
- âœ… **æœåŠ¡å¯ç”¨**ï¼šè¯­éŸ³åˆæˆæœåŠ¡åŸºæœ¬å¯ç”¨
- âœ… **é™çº§æœºåˆ¶**ï¼šAPIå¤±è´¥æ—¶æä¾›Mockæ•°æ®ä¿è¯ä½“éªŒ

**å½“å‰çŠ¶æ€**ï¼š
- ğŸ”§ **å¼€å‘é˜¶æ®µ**ï¼šåŸºç¡€æ¡†æ¶å®Œæˆï¼Œæ­£åœ¨ä¼˜åŒ–å‚æ•°
- âš¡ **å¯ç”¨æ€§**ï¼šåŸºæœ¬å¯ç”¨ï¼Œå“åº”æ—¶é—´éœ€ä¼˜åŒ–
- ğŸ“± **å°ç¨‹åºé›†æˆ**ï¼šå¯ä»¥æ­£å¸¸è°ƒç”¨å’Œæ¥æ”¶éŸ³é¢‘æ•°æ®

æ„Ÿè°¢æ‚¨æä¾›çš„å®˜æ–¹æ–‡æ¡£ï¼Œè¿™å¯¹ä¿®å¤è¯­éŸ³åˆæˆåŠŸèƒ½éå¸¸æœ‰å¸®åŠ©ï¼WebSocketæ–¹å¼å·²ç»æˆåŠŸå»ºç«‹è¿æ¥å¹¶æ¥æ”¶åˆ°éŸ³é¢‘æ•°æ®ï¼Œè¯´æ˜æ–¹å‘æ˜¯æ­£ç¡®çš„ã€‚ 